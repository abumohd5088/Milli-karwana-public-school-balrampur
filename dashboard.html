<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milli Karwaan Public School - Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: #fff;
            overflow-x: hidden;
            transition: background 0.3s ease;
        }
        .light-theme {
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            color: #333;
        }
        .light-theme .card {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        .light-theme .nav-item.active {
            background: rgba(0, 0, 0, 0.1);
        }
        .light-theme .homework-item,
        .light-theme .assignment-item,
        .light-theme .announcement-item {
            background: rgba(255, 255, 255, 0.8);
            color: #333;
        }
        .light-theme .subject-tag {
            background: rgba(0, 0, 0, 0.1);
            color: #333;
        }
        .light-theme .badge {
            background: rgba(0, 0, 0, 0.1);
        }
        .light-theme .btn-primary {
            background: #0066cc;
        }
        .light-theme .btn-secondary {
            background: #666;
        }
        .container {
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            width: 280px;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            padding: 2rem 1.5rem;
            position: fixed;
            height: 100%;
            transition: transform 0.3s ease;
            z-index: 100;
        }
        .sidebar.open {
            transform: translateX(0);
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .logo img {
            width: 50px;
            height: 50px;
        }
        .logo h2 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        .nav-menu {
            margin-top: 2rem;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .nav-item:hover, .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
        }
        .nav-item i {
            width: 24px;
            text-align: center;
        }
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
        }
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
        }
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 101;
        }
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 99;
            display: none;
        }
        .overlay.active {
            display: block;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .page-title {
            font-size: 2rem;
            font-weight: 600;
        }
        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: #00c6ff;
            color: white;
        }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .card-title i {
            color: #00c6ff;
        }
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        .tab {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        .tab.active {
            background: rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }
        .homework-item, .assignment-item, .announcement-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 0.8rem;
            background: rgba(255, 255, 255, 0.1);
            border-left: 4px solid #00c6ff;
            transition: transform 0.2s ease;
        }
        .homework-item:hover, .assignment-item:hover, .announcement-item:hover {
            transform: translateX(5px);
        }
        .assignment-item {
            border-left-color: #ff6b6b;
        }
        .announcement-item {
            border-left-color: #4ecdc4;
        }
        .subject-tag {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            color: white;
        }
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        .badge.pending {
            background: #ff9966;
        }
        .badge.completed {
            background: #00c6ff;
        }
        .flex {
            display: flex;
        }
        .items-center {
            align-items: center;
        }
        .justify-between {
            justify-content: space-between;
        }
        .gap-2 {
            gap: 0.5rem;
        }
        .gap-3 {
            gap: 0.75rem;
        }
        .mt-2 {
            margin-top: 0.5rem;
        }
        .mt-6 {
            margin-top: 1.5rem;
        }
        .mb-3 {
            margin-bottom: 0.75rem;
        }
        .py-3 {
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
        }
        .px-2 {
            padding-left: 0.5rem;
            padding-right: 0.5rem;
        }
        .font-semibold {
            font-weight: 600;
        }
        .text-sm {
            font-size: 0.875rem;
        }
        .text-gray-400 {
            color: rgba(255, 255, 255, 0.6);
        }
        .text-center {
            text-align: center;
        }
        .py-8 {
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        .hidden {
            display: none;
        }
        .page-content {
            transition: opacity 0.3s ease;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }
        td {
            padding: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .profile-actions {
            display: flex;
            gap: 0.5rem;
        }
        .dropdown {
            position: relative;
            display: inline-block;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            min-width: 160px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            z-index: 1;
            border-radius: 8px;
            overflow: hidden;
        }
        .dropdown-content.show {
            display: block;
        }
        .dropdown-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .ai-assistant {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: #00c6ff;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 198, 255, 0.4);
            z-index: 1000;
            transition: all 0.3s ease;
        }
        .ai-assistant:hover {
            transform: scale(1.1);
            background: #00a8d8;
        }
        .ai-chat {
            position: fixed;
            bottom: 80px;
            right: 2rem;
            width: 350px;
            height: 500px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 999;
            display: none;
            flex-direction: flex-col;
        }
        .ai-chat-header {
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        .ai-chat-body {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .message {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 18px;
            line-height: 1.4;
        }
        .message.user {
            align-self: flex-end;
            background: #00c6ff;
            color: white;
            border-bottom-right-radius: 4px;
        }
        .message.assistant {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.1);
            border-bottom-left-radius: 4px;
        }
        .ai-chat-footer {
            padding: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            gap: 0.5rem;
        }
        .ai-chat-footer input {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 0.9rem;
        }
        .ai-chat-footer input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        .ai-chat-footer button {
            background: #00c6ff;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .typing {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }
        .typing-dots {
            display: flex;
            gap: 0.2rem;
        }
        .typing-dot {
            width: 6px;
            height: 6px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            animation: pulse 1.5s infinite ease-in-out;
        }
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.6; }
        }
        .notification-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            background: #ff6b6b;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            padding: 2rem;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        .modal-header h3 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        .modal-header i {
            cursor: pointer;
            color: rgba(255, 255, 255, 0.6);
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 0.9rem;
        }
        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        .form-control.dark {
            color: #333;
        }
        .form-control.dark::placeholder {
            color: #666;
        }
        footer {
            text-align: center;
            padding: 1.5rem;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.875rem;
            margin-top: 3rem;
        }
        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }
        .progress {
            height: 100%;
            background: #00c6ff;
            border-radius: 4px;
        }
        .chart-container {
            height: 300px;
        }
        .user-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #4ecdc4;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        .user-status.inactive {
            background: #ff6b6b;
        }
    </style>
</head>
<body>
    <!-- Mobile menu button -->
    <button class="mobile-menu-btn">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <img src="https://i.postimg.cc/ryGx49TB/erasebg-transformed.png" alt="School Logo">
            <h2>MKPS</h2>
        </div>
        <div class="nav-menu mt-8">
            <div class="nav-item active" data-page="dashboard">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </div>
            <div class="nav-item" data-page="homework">
                <i class="fas fa-book"></i>
                <span>Homework</span>
            </div>
            <div class="nav-item" data-page="assignments">
                <i class="fas fa-tasks"></i>
                <span>Assignments</span>
            </div>
            <div class="nav-item" data-page="timetable">
                <i class="fas fa-calendar-alt"></i>
                <span>Timetable</span>
            </div>
            <div class="nav-item" data-page="resources">
                <i class="fas fa-book-open"></i>
                <span>Resources</span>
            </div>
            <div class="nav-item" data-page="profile">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </div>
            <div class="nav-item" data-page="admin-panel" id="admin-panel-btn" style="display: none;">
                <i class="fas fa-cog"></i>
                <span>Admin Panel</span>
            </div>
        </div>
    </div>

    <!-- Overlay for mobile menu -->
    <div class="overlay"></div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <h1 class="page-title">Dashboard</h1>
            <div class="header-actions">
                <button id="theme-toggle" class="btn btn-secondary">
                    <i class="fas fa-moon"></i>
                    <span>Dark Mode</span>
                </button>
                <div class="dropdown">
                    <button id="profile-dropdown" class="btn btn-secondary">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                    <div class="dropdown-content" id="profile-menu">
                        <div class="dropdown-item" id="logout-btn">
                            <i class="fas fa-sign-out-alt"></i>
                            Logout
                        </div>
                    </div>
                </div>
                <button id="notification-btn" class="btn btn-secondary position-relative">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notification-count">0</span>
                </button>
            </div>
        </div>

        <!-- Dashboard Page -->
        <div class="page-content" id="dashboard-page">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-book"></i>
                        <span>Pending Homework</span>
                    </div>
                    <h2 id="pending-hw" class="text-3xl font-bold">0</h2>
                </div>
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-calendar-check"></i>
                        <span>Upcoming Tests</span>
                    </div>
                    <h2 id="upcoming-tests" class="text-3xl font-bold">3</h2>
                </div>
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-graduation-cap"></i>
                        <span>Average Grade</span>
                    </div>
                    <h2 id="avg-grade" class="text-3xl font-bold">B+</h2>
                </div>
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-chart-line"></i>
                        <span>Attendance</span>
                    </div>
                    <h2 id="attendance" class="text-3xl font-bold">95%</h2>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-chart-line"></i>
                        <span>Performance Trend</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-bell"></i>
                        <span>Recent Activity</span>
                    </div>
                    <div id="recent-activity">
                        <!-- Activity items will be added here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Homework Page -->
        <div class="page-content hidden" id="homework-page">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-book"></i>
                    <span>Homework</span>
                </div>
                <div class="tabs">
                    <div class="tab active" data-filter="all">All</div>
                    <div class="tab" data-filter="pending">Pending</div>
                    <div class="tab" data-filter="completed">Completed</div>
                    <div class="tab" data-filter="math">Mathematics</div>
                    <div class="tab" data-filter="science">Science</div>
                    <div class="tab" data-filter="english">English</div>
                    <div class="tab" data-filter="social">Social Studies</div>
                    <div class="tab" data-filter="hindi">Hindi</div>
                </div>
                <div id="homework-list">
                    <!-- Homework items will be added here -->
                </div>
            </div>
        </div>

        <!-- Assignments Page -->
        <div class="page-content hidden" id="assignments-page">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-tasks"></i>
                    <span>Assignments</span>
                </div>
                <div class="tabs">
                    <div class="tab active" data-filter="all">All</div>
                    <div class="tab" data-filter="pending">Pending</div>
                    <div class="tab" data-filter="submitted">Submitted</div>
                    <div class="tab" data-filter="math">Mathematics</div>
                    <div class="tab" data-filter="science">Science</div>
                    <div class="tab" data-filter="english">English</div>
                    <div class="tab" data-filter="social">Social Studies</div>
                    <div class="tab" data-filter="hindi">Hindi</div>
                </div>
                <div id="assignments-list">
                    <!-- Assignment items will be added here -->
                </div>
            </div>
        </div>

        <!-- Timetable Page -->
        <div class="page-content hidden" id="timetable-page">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Weekly Timetable</span>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Monday</th>
                            <th>Tuesday</th>
                            <th>Wednesday</th>
                            <th>Thursday</th>
                            <th>Friday</th>
                        </tr>
                    </thead>
                    <tbody id="timetable-body">
                        <!-- Timetable rows will be added here -->
                    </tbody>
                </table>
            </div>
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-calendar-check"></i>
                    <span>Upcoming Events</span>
                </div>
                <div id="upcoming-events">
                    <!-- Event items will be added here -->
                </div>
            </div>
        </div>

        <!-- Resources Page -->
        <div class="page-content hidden" id="resources-page">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-book-open"></i>
                    <span>Study Resources</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="card">
                        <h3 class="font-semibold mb-2">Mathematics</h3>
                        <p class="text-sm text-gray-400 mb-3">Practice problems, formulas, and video tutorials</p>
                        <a href="#" class="btn btn-primary text-sm">View Resources</a>
                    </div>
                    <div class="card">
                        <h3 class="font-semibold mb-2">Science</h3>
                        <p class="text-sm text-gray-400 mb-3">Lab experiments, diagrams, and research papers</p>
                        <a href="#" class="btn btn-primary text-sm">View Resources</a>
                    </div>
                    <div class="card">
                        <h3 class="font-semibold mb-2">English</h3>
                        <p class="text-sm text-gray-400 mb-3">Grammar guides, reading materials, and writing tips</p>
                        <a href="#" class="btn btn-primary text-sm">View Resources</a>
                    </div>
                    <div class="card">
                        <h3 class="font-semibold mb-2">Social Studies</h3>
                        <p class="text-sm text-gray-400 mb-3">Historical timelines, maps, and current affairs</p>
                        <a href="#" class="btn btn-primary text-sm">View Resources</a>
                    </div>
                    <div class="card">
                        <h3 class="font-semibold mb-2">Hindi</h3>
                        <p class="text-sm text-gray-400 mb-3">Vocabulary, grammar, and literature</p>
                        <a href="#" class="btn btn-primary text-sm">View Resources</a>
                    </div>
                    <div class="card">
                        <h3 class="font-semibold mb-2">Exam Preparation</h3>
                        <p class="text-sm text-gray-400 mb-3">Past papers, study guides, and revision tips</p>
                        <a href="#" class="btn btn-primary text-sm">View Resources</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Page -->
        <div class="page-content hidden" id="profile-page">
            <div class="card">
                <div class="profile-header">
                    <h2 class="card-title">
                        <i class="fas fa-user"></i>
                        <span>Profile</span>
                    </div>
                    <div class="profile-actions">
                        <button class="btn btn-primary" id="edit-profile-btn">Edit Profile</button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-semibold mb-4">Personal Information</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="text-sm text-gray-400">Name</label>
                                <p id="profile-display-name">John Doe</p>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400">Class</label>
                                <p id="profile-display-class">Class 8</p>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400">Parent/Guardian</label>
                                <p id="profile-display-parent">Jane Doe</p>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400">Student ID</label>
                                <p id="profile-display-id">MKPS08001</p>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400">Email</label>
                                <p id="profile-display-email">john.doe@mkps.edu</p>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400">Phone</label>
                                <p id="profile-display-phone">+123 456 7890</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="font-semibold mb-4">Academic Progress</h3>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between">
                                    <span>Profile Completion</span>
                                    <span id="profile-completion">80%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress" id="profile-progress" style="width: 80%;"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between">
                                    <span>Average Grade</span>
                                    <span id="profile-average">B+</span>
                                </div>
                                <div class="chart-container mt-4">
                                    <canvas id="gradesChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Panel Page -->
        <div class="page-content hidden" id="admin-panel-page">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-book"></i>
                        <span>Manage Homework</span>
                    </div>
                    <button class="btn btn-primary mb-4" id="add-homework-btn">Add Homework</button>
                    <div id="homework-admin-list">
                        <!-- Admin homework list will be added here -->
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-tasks"></i>
                        <span>Manage Assignments</span>
                    </div>
                    <button class="btn btn-primary mb-4" id="add-assignment-btn">Add Assignment</button>
                    <div id="assignments-admin-list">
                        <!-- Admin assignments list will be added here -->
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-bullhorn"></i>
                        <span>Announcements</span>
                    </div>
                    <button class="btn btn-primary mb-4" id="add-announcement-btn">Post Announcement</button>
                    <div id="announcements-admin-list">
                        <!-- Admin announcements list will be added here -->
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Timetable Management</span>
                    </div>
                    <button class="btn btn-primary mb-4" id="edit-timetable-btn">Edit Timetable</button>
                    <table>
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Monday</th>
                                <th>Tuesday</th>
                                <th>Wednesday</th>
                                <th>Thursday</th>
                                <th>Friday</th>
                            </tr>
                        </thead>
                        <tbody id="timetable-admin-body">
                            <!-- Timetable rows will be added here -->
                        </tbody>
                    </table>
                </div>
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-users"></i>
                        <span>User Management</span>
                    </div>
                    <div id="user-management">
                        <!-- User management table will be added here -->
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">
                        <i class="fas fa-envelope"></i>
                        <span>Messages</span>
                    </div>
                    <div id="messages-list">
                        <!-- Messages list will be added here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Assistant Button -->
        <div class="ai-assistant" id="ai-button">
            <i class="fas fa-robot"></i>
        </div>

        <!-- AI Chat Window -->
        <div class="ai-chat" id="ai-chat">
            <div class="ai-chat-header">
                <h3>AI Study Assistant</h3>
                <i class="fas fa-times" id="close-ai-chat"></i>
            </div>
            <div class="ai-chat-body" id="ai-chat-body">
                <div class="message assistant">Hello! I'm your AI study assistant. How can I help you with your studies today?</div>
            </div>
            <div class="ai-chat-footer">
                <input type="text" placeholder="Ask a question..." id="ai-chat-input">
                <button id="ai-chat-send"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>

        <!-- Add Homework Modal -->
        <div id="homework-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="homework-modal-title">Add Homework</h3>
                    <i class="fas fa-times" id="close-homework-modal"></i>
                </div>
                <div class="form-group">
                    <label for="homework-title">Title</label>
                    <input type="text" id="homework-title" class="form-control" placeholder="Enter homework title">
                </div>
                <div class="form-group">
                    <label for="homework-subject">Subject</label>
                    <select id="homework-subject" class="form-control">
                        <option value="math">Mathematics</option>
                        <option value="science">Science</option>
                        <option value="english">English</option>
                        <option value="social">Social Studies</option>
                        <option value="hindi">Hindi</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="homework-class">Class</label>
                    <select id="homework-class" class="form-control">
                        <option value="all">All Classes</option>
                        <option value="1">Class 1</option>
                        <option value="2">Class 2</option>
                        <option value="3">Class 3</option>
                        <option value="4">Class 4</option>
                        <option value="5">Class 5</option>
                        <option value="6">Class 6</option>
                        <option value="7">Class 7</option>
                        <option value="8">Class 8</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="homework-description">Description</label>
                    <textarea id="homework-description" class="form-control" rows="4" placeholder="Enter homework description"></textarea>
                </div>
                <div class="form-group">
                    <label for="homework-due-date">Due Date</label>
                    <input type="date" id="homework-due-date" class="form-control">
                </div>
                <div class="form-group">
                    <label for="homework-points">Points</label>
                    <input type="number" id="homework-points" class="form-control" value="10">
                </div>
                <div class="flex justify-end mt-6">
                    <button class="btn btn-secondary mr-3" id="cancel-homework-modal">Cancel</button>
                    <button class="btn btn-primary" id="save-homework">Save Homework</button>
                </div>
            </div>
        </div>

        <!-- Add Assignment Modal -->
        <div id="assignment-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="assignment-modal-title">Add Assignment</h3>
                    <i class="fas fa-times" id="close-assignment-modal"></i>
                </div>
                <div class="form-group">
                    <label for="assignment-title">Title</label>
                    <input type="text" id="assignment-title" class="form-control" placeholder="Enter assignment title">
                </div>
                <div class="form-group">
                    <label for="assignment-subject">Subject</label>
                    <select id="assignment-subject" class="form-control">
                        <option value="math">Mathematics</option>
                        <option value="science">Science</option>
                        <option value="english">English</option>
                        <option value="social">Social Studies</option>
                        <option value="hindi">Hindi</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="assignment-class">Class</label>
                    <select id="assignment-class" class="form-control">
                        <option value="all">All Classes</option>
                        <option value="1">Class 1</option>
                        <option value="2">Class 2</option>
                        <option value="3">Class 3</option>
                        <option value="4">Class 4</option>
                        <option value="5">Class 5</option>
                        <option value="6">Class 6</option>
                        <option value="7">Class 7</option>
                        <option value="8">Class 8</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="assignment-description">Description</label>
                    <textarea id="assignment-description" class="form-control" rows="4" placeholder="Enter assignment description"></textarea>
                </div>
                <div class="form-group">
                    <label for="assignment-due-date">Due Date</label>
                    <input type="date" id="assignment-due-date" class="form-control">
                </div>
                <div class="form-group">
                    <label for="assignment-points">Points</label>
                    <input type="number" id="assignment-points" class="form-control" value="20">
                </div>
                <div class="flex justify-end mt-6">
                    <button class="btn btn-secondary mr-3" id="cancel-assignment-modal">Cancel</button>
                    <button class="btn btn-primary" id="save-assignment">Save Assignment</button>
                </div>
            </div>
        </div>

        <!-- Add Announcement Modal -->
        <div id="announcement-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="announcement-modal-title">Post Announcement</h3>
                    <i class="fas fa-times" id="close-announcement-modal"></i>
                </div>
                <div class="form-group">
                    <label for="announcement-title">Title</label>
                    <input type="text" id="announcement-title" class="form-control" placeholder="Enter announcement title">
                </div>
                <div class="form-group">
                    <label for="announcement-type">Type</label>
                    <select id="announcement-type" class="form-control">
                        <option value="info">Information</option>
                        <option value="event">Event</option>
                        <option value="warning">Warning</option>
                        <option value="success">Success</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="announcement-content">Content</label>
                    <textarea id="announcement-content" class="form-control" rows="6" placeholder="Enter announcement content"></textarea>
                </div>
                <div class="flex justify-end mt-6">
                    <button class="btn btn-secondary mr-3" id="cancel-announcement-modal">Cancel</button>
                    <button class="btn btn-primary" id="post-announcement">Post Announcement</button>
                </div>
            </div>
        </div>

        <!-- Edit Timetable Modal -->
        <div id="timetable-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Edit Timetable</h3>
                    <i class="fas fa-times" id="close-timetable-modal"></i>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Monday</th>
                            <th>Tuesday</th>
                            <th>Wednesday</th>
                            <th>Thursday</th>
                            <th>Friday</th>
                        </tr>
                    </thead>
                    <tbody id="timetable-edit-body">
                        <!-- Timetable edit rows will be added here -->
                    </tbody>
                </table>
                <div class="flex justify-end mt-6">
                    <button class="btn btn-secondary mr-3" id="cancel-timetable-modal">Cancel</button>
                    <button class="btn btn-primary" id="save-timetable">Save Changes</button>
                </div>
            </div>
        </div>

        <!-- Notifications Modal -->
        <div id="notifications-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Notifications</h3>
                    <i class="fas fa-times" id="close-notifications-modal"></i>
                </div>
                <div id="notifications-list">
                    <!-- Notifications will be added here -->
                </div>
                <div class="flex justify-end mt-6">
                    <button class="btn btn-secondary mr-3" id="mark-all-read">Mark all as read</button>
                    <button class="btn btn-primary" id="close-notifications">Close</button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <p>&copy; 2023 Milli Karwaan Public School. All rights reserved.</p>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCdzFBQ1KVgBfmmjSgHJJwcuLbqne9VjUs",
            authDomain: "mkps-school.firebaseapp.com",
            projectId: "mkps-school",
            storageBucket: "mkps-school.appspot.com",
            messagingSenderId: "529549341206",
            appId: "1:529549341206:web:8a3e2d9d7c1b8e7d9e8f1a"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // DOM Elements
        const studentNameEl = document.getElementById('student-name');
        const studentClassEl = document.getElementById('student-class');
        const pendingHwEl = document.getElementById('pending-hw');
        const upcomingTestsEl = document.getElementById('upcoming-tests');
        const avgGradeEl = document.getElementById('avg-grade');
        const attendanceEl = document.getElementById('attendance');
        const navItems = document.querySelectorAll('.nav-item');
        const themeToggle = document.getElementById('theme-toggle');
        const logoutBtn = document.getElementById('logout-btn');
        const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
        const overlay = document.querySelector('.overlay');
        const sidebar = document.querySelector('.sidebar');
        const profileDropdown = document.getElementById('profile-dropdown');
        const profileMenu = document.getElementById('profile-menu');
        const notificationBtn = document.getElementById('notification-btn');
        const notificationCount = document.getElementById('notification-count');
        const aiButton = document.getElementById('ai-button');
        const aiChat = document.getElementById('ai-chat');
        const closeAiChat = document.getElementById('close-ai-chat');
        const aiChatInput = document.getElementById('ai-chat-input');
        const aiChatSend = document.getElementById('ai-chat-send');
        const aiChatBody = document.getElementById('ai-chat-body');

        // Modal elements
        const homeworkModal = document.getElementById('homework-modal');
        const homeworkModalTitle = document.getElementById('homework-modal-title');
        const homeworkTitle = document.getElementById('homework-title');
        const homeworkSubject = document.getElementById('homework-subject');
        const homeworkClass = document.getElementById('homework-class');
        const homeworkDescription = document.getElementById('homework-description');
        const homeworkDueDate = document.getElementById('homework-due-date');
        const homeworkPoints = document.getElementById('homework-points');
        const closeHomeworkModal = document.getElementById('close-homework-modal');
        const cancelHomeworkModal = document.getElementById('cancel-homework-modal');
        const saveHomework = document.getElementById('save-homework');

        const assignmentModal = document.getElementById('assignment-modal');
        const assignmentModalTitle = document.getElementById('assignment-modal-title');
        const assignmentTitle = document.getElementById('assignment-title');
        const assignmentSubject = document.getElementById('assignment-subject');
        const assignmentClass = document.getElementById('assignment-class');
        const assignmentDescription = document.getElementById('assignment-description');
        const assignmentDueDate = document.getElementById('assignment-due-date');
        const assignmentPoints = document.getElementById('assignment-points');
        const closeAssignmentModal = document.getElementById('close-assignment-modal');
        const cancelAssignmentModal = document.getElementById('cancel-assignment-modal');
        const saveAssignment = document.getElementById('save-assignment');

        const announcementModal = document.getElementById('announcement-modal');
        const announcementTitle = document.getElementById('announcement-title');
        const announcementType = document.getElementById('announcement-type');
        const announcementContent = document.getElementById('announcement-content');
        const closeAnnouncementModal = document.getElementById('close-announcement-modal');
        const cancelAnnouncementModal = document.getElementById('cancel-announcement-modal');
        const postAnnouncement = document.getElementById('post-announcement');

        const timetableModal = document.getElementById('timetable-modal');
        const closeTimetableModal = document.getElementById('close-timetable-modal');
        const cancelTimetableModal = document.getElementById('cancel-timetable-modal');
        const saveTimetable = document.getElementById('save-timetable');

        const notificationsModal = document.getElementById('notifications-modal');
        const closeNotificationsModal = document.getElementById('close-notifications-modal');
        const closeNotifications = document.getElementById('close-notifications');
        const markAllRead = document.getElementById('mark-all-read');

        // Profile elements
        const profileDisplayName = document.getElementById('profile-display-name');
        const profileDisplayClass = document.getElementById('profile-display-class');
        const profileDisplayParent = document.getElementById('profile-display-parent');
        const profileDisplayId = document.getElementById('profile-display-id');
        const profileDisplayEmail = document.getElementById('profile-display-email');
        const profileDisplayPhone = document.getElementById('profile-display-phone');
        const profileCompletion = document.getElementById('profile-completion');
        const profileProgress = document.getElementById('profile-progress');
        const profileAverage = document.getElementById('profile-average');

        // Admin panel elements
        const adminPanelBtn = document.getElementById('admin-panel-btn');
        const addHomeworkBtn = document.getElementById('add-homework-btn');
        const addAssignmentBtn = document.getElementById('add-assignment-btn');
        const addAnnouncementBtn = document.getElementById('add-announcement-btn');
        const editTimetableBtn = document.getElementById('edit-timetable-btn');

        // Global variables
        let homeworkData = [];
        let assignmentsData = [];
        let timetableData = [];
        let announcementsData = [];
        let gradesData = [];
        let performanceData = [];
        let userData = [];
        let messagesData = [];
        let notifications = [];
        let currentStudent = null;
        let isOnline = navigator.onLine;

        // Check if user is logged in
        function checkLogin() {
            const studentData = localStorage.getItem('mkps_student');
            if (!studentData) {
                window.location.href = 'index.html';
                return false;
            }
            currentStudent = JSON.parse(studentData);
            return true;
        }

        // Initialize the app
        function initApp() {
            // Check login status
            if (!checkLogin()) return;

            // Set profile data
            profileDisplayName.textContent = currentStudent.name;
            profileDisplayClass.textContent = `Class ${currentStudent.class || 'N/A'}`;
            profileDisplayParent.textContent = currentStudent.parent || 'Not specified';
            profileDisplayId.textContent = `MKPS${String(currentStudent.class).padStart(2, '0')}${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}`;
            profileDisplayEmail.textContent = currentStudent.email || `${currentStudent.name.toLowerCase().replace(' ', '.')}@mkps.edu`;
            profileDisplayPhone.textContent = currentStudent.phone || 'Not specified';

            // Check admin access
            checkAdminAccess();

            // Load data from Firestore
            loadData();

            // Set up event listeners
            setupEventListeners();

            // Load dashboard data
            loadDashboardData();

            // Create charts
            createCharts();

            // Check theme preference
            const savedTheme = localStorage.getItem('mkps_theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i><span>Light Mode</span>';
            }

            // Update notification count
            updateNotificationCount();
        }

        // Check if current user has admin access
        function checkAdminAccess() {
            if (currentStudent.name === 'Admin' || currentStudent.email === 'admin@mkps.edu') {
                adminPanelBtn.style.display = 'flex';
            } else {
                adminPanelBtn.style.display = 'none';
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Navigation
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    const page = item.getAttribute('data-page');
                    if (page) {
                        // Update active nav item
                        navItems.forEach(nav => nav.classList.remove('active'));
                        item.classList.add('active');

                        // Show selected page
                        document.querySelectorAll('.page-content').forEach(content => {
                            content.classList.add('hidden');
                        });

                        // Check if user has admin access for admin panel
                        if (page === 'admin-panel') {
                            if (currentStudent.name === 'Admin' || currentStudent.email === 'admin@mkps.edu') {
                                document.getElementById(`${page}-page`).classList.remove('hidden');
                            } else {
                                alert('You do not have permission to access the admin panel.');
                                item.classList.remove('active');
                                document.querySelector('[data-page="dashboard"]').classList.add('active');
                                document.getElementById('dashboard-page').classList.remove('hidden');
                            }
                        } else {
                            document.getElementById(`${page}-page`).classList.remove('hidden');
                        }
                    }
                });
            });

            // Theme toggle
            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('light-theme');
                if (document.body.classList.contains('light-theme')) {
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i><span>Light Mode</span>';
                    localStorage.setItem('mkps_theme', 'light');
                } else {
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i><span>Dark Mode</span>';
                    localStorage.setItem('mkps_theme', 'dark');
                }
            });

            // Logout
            logoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (confirm('Are you sure you want to logout?')) {
                    localStorage.removeItem('mkps_student');
                    window.location.href = 'index.html';
                }
            });

            // Mobile menu
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.add('open');
                overlay.classList.add('active');
            });

            overlay.addEventListener('click', () => {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
            });

            // Profile dropdown
            profileDropdown.addEventListener('click', () => {
                profileMenu.classList.toggle('show');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!profileDropdown.contains(e.target) && !profileMenu.contains(e.target)) {
                    profileMenu.classList.remove('show');
                }
            });

            // Notifications
            notificationBtn.addEventListener('click', () => {
                loadNotifications();
                notificationsModal.classList.remove('hidden');
            });

            closeNotificationsModal.addEventListener('click', () => {
                notificationsModal.classList.add('hidden');
            });

            closeNotifications.addEventListener('click', () => {
                notificationsModal.classList.add('hidden');
            });

            markAllRead.addEventListener('click', () => {
                notifications.forEach(n => n.read = true);
                db.collection('notifications').get().then(snapshot => {
                    snapshot.forEach(doc => {
                        db.collection('notifications').doc(doc.id).update({ read: true });
                    });
                });
                updateNotificationCount();
                notificationsModal.classList.add('hidden');
            });

            // AI Assistant
            aiButton.addEventListener('click', () => {
                aiChat.style.display = 'flex';
            });

            closeAiChat.addEventListener('click', () => {
                aiChat.style.display = 'none';
            });

            aiChatSend.addEventListener('click', sendAiMessage);
            aiChatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendAiMessage();
                }
            });

            // Modal close buttons
            closeHomeworkModal.addEventListener('click', () => {
                homeworkModal.classList.add('hidden');
            });

            cancelHomeworkModal.addEventListener('click', () => {
                homeworkModal.classList.add('hidden');
            });

            closeAssignmentModal.addEventListener('click', () => {
                assignmentModal.classList.add('hidden');
            });

            cancelAssignmentModal.addEventListener('click', () => {
                assignmentModal.classList.add('hidden');
            });

            closeAnnouncementModal.addEventListener('click', () => {
                announcementModal.classList.add('hidden');
            });

            cancelAnnouncementModal.addEventListener('click', () => {
                announcementModal.classList.add('hidden');
            });

            closeTimetableModal.addEventListener('click', () => {
                timetableModal.classList.add('hidden');
            });

            cancelTimetableModal.addEventListener('click', () => {
                timetableModal.classList.add('hidden');
            });

            // Admin panel buttons
            addHomeworkBtn.addEventListener('click', () => {
                homeworkModalTitle.textContent = 'Add Homework';
                homeworkTitle.value = '';
                homeworkDescription.value = '';
                homeworkModal.classList.remove('hidden');
            });

            addAssignmentBtn.addEventListener('click', () => {
                assignmentModalTitle.textContent = 'Add Assignment';
                assignmentTitle.value = '';
                assignmentDescription.value = '';
                assignmentModal.classList.remove('hidden');
            });

            addAnnouncementBtn.addEventListener('click', () => {
                announcementTitle.value = '';
                announcementContent.value = '';
                announcementModal.classList.remove('hidden');
            });

            editTimetableBtn.addEventListener('click', () => {
                populateTimetableEdit();
                timetableModal.classList.remove('hidden');
            });

            // Save buttons
            saveHomework.addEventListener('click', saveHomeworkItem);
            saveAssignment.addEventListener('click', saveAssignmentItem);
            postAnnouncement.addEventListener('click', postAnnouncementItem);
            saveTimetable.addEventListener('click', saveTimetableChanges);
        }

        // Load data from Firestore
        function loadData() {
            // Listen for real-time updates on homework
            db.collection('homework').onSnapshot(snapshot => {
                homeworkData = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    // Only include homework for current student's class or "all"
                    if (data.class === 'all' || data.class === String(currentStudent.class)) {
                        homeworkData.push({
                            id: doc.id,
                            ...data
                        });
                    }
                });
                filterHomework(document.querySelector('#homework-page .tabs .tab.active').getAttribute('data-filter'));
                loadDashboardData();
            });

            // Listen for real-time updates on assignments
            db.collection('assignments').onSnapshot(snapshot => {
                assignmentsData = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    // Only include assignments for current student's class or "all"
                    if (data.class === 'all' || data.class === String(currentStudent.class)) {
                        assignmentsData.push({
                            id: doc.id,
                            ...data
                        });
                    }
                });
                filterAssignments(document.querySelector('#assignments-page .tabs .tab.active').getAttribute('data-filter'));
                loadDashboardData();
            });

            // Listen for real-time updates on timetable
            db.collection('timetable').onSnapshot(snapshot => {
                timetableData = [];
                snapshot.forEach(doc => {
                    timetableData.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                loadTimetable();
            });

            // Listen for real-time updates on announcements
            db.collection('announcements').onSnapshot(snapshot => {
                announcementsData = [];
                snapshot.forEach(doc => {
                    announcementsData.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                loadAnnouncements();
            });

            // Listen for real-time updates on notifications
            db.collection('notifications').onSnapshot(snapshot => {
                notifications = [];
                snapshot.forEach(doc => {
                    notifications.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                updateNotificationCount();
            });

            // Load user data (admin only)
            if (currentStudent.name === 'Admin' || currentStudent.email === 'admin@mkps.edu') {
                db.collection('users').onSnapshot(snapshot => {
                    userData = [];
                    snapshot.forEach(doc => {
                        userData.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    loadUserManagement();
                });

                db.collection('messages').onSnapshot(snapshot => {
                    messagesData = [];
                    snapshot.forEach(doc => {
                        messagesData.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    loadMessages();
                });
            }
        }

        // Load timetable
        function loadTimetable() {
            const timetableBody = document.getElementById('timetable-body');
            timetableBody.innerHTML = '';
            timetableData.forEach(period => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-700';
                row.innerHTML = `
                    <td class="py-3 px-2 font-medium">${period.time}</td>
                    <td class="py-3 px-2">${period.mon}</td>
                    <td class="py-3 px-2">${period.tue}</td>
                    <td class="py-3 px-2">${period.wed}</td>
                    <td class="py-3 px-2">${period.thu}</td>
                    <td class="py-3 px-2">${period.fri}</td>
                `;
                timetableBody.appendChild(row);
            });
        }

        // Populate timetable edit modal
        function populateTimetableEdit() {
            const timetableEditBody = document.getElementById('timetable-edit-body');
            timetableEditBody.innerHTML = '';
            timetableData.forEach(period => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-700';
                row.innerHTML = `
                    <td class="py-3 px-2"><input type="text" class="form-control" value="${period.time}" data-id="${period.id}" data-field="time"></td>
                    <td class="py-3 px-2"><input type="text" class="form-control" value="${period.mon}" data-id="${period.id}" data-field="mon"></td>
                    <td class="py-3 px-2"><input type="text" class="form-control" value="${period.tue}" data-id="${period.id}" data-field="tue"></td>
                    <td class="py-3 px-2"><input type="text" class="form-control" value="${period.wed}" data-id="${period.id}" data-field="wed"></td>
                    <td class="py-3 px-2"><input type="text" class="form-control" value="${period.thu}" data-id="${period.id}" data-field="thu"></td>
                    <td class="py-3 px-2"><input type="text" class="form-control" value="${period.fri}" data-id="${period.id}" data-field="fri"></td>
                `;
                timetableEditBody.appendChild(row);
            });
        }

        // Save timetable changes
        function saveTimetableChanges() {
            const inputs = document.querySelectorAll('#timetable-edit-body input');
            const updates = {};
            
            inputs.forEach(input => {
                const id = input.getAttribute('data-id');
                const field = input.getAttribute('data-field');
                const value = input.value;
                
                if (!updates[id]) {
                    updates[id] = {};
                }
                updates[id][field] = value;
            });
            
            Object.keys(updates).forEach(id => {
                db.collection('timetable').doc(id).update(updates[id])
                .then(() => {
                    console.log('Timetable updated successfully');
                })
                .catch(error => {
                    console.error('Error updating timetable: ', error);
                    alert('Error updating timetable. Please try again.');
                });
            });
            
            timetableModal.classList.add('hidden');
            alert('Timetable updated successfully!');
        }

        // Load announcements
        function loadAnnouncements() {
            const announcementsList = document.getElementById('announcements-list');
            announcementsList.innerHTML = '';
            const filteredAnnouncements = announcementsData.filter(ann => 
                ann.class === 'all' || ann.class === String(currentStudent.class)
            ).sort((a, b) => new Date(b.date) - new Date(a.date));
            
            filteredAnnouncements.forEach(ann => {
                const annEl = document.createElement('div');
                annEl.className = 'announcement-item';
                const typeColor = getTypeColor(ann.type);
                annEl.style.borderLeftColor = typeColor;
                annEl.innerHTML = `
                    <div>
                        <h4 class="font-semibold">${ann.title}</h4>
                        <p class="text-sm text-gray-400">${ann.content}</p>
                        <div class="flex items-center gap-2 mt-2">
                            <span class="badge" style="background: ${typeColor}">${getTypeName(ann.type)}</span>
                            <span class="text-sm">Posted: ${formatDate(ann.date)}</span>
                            <span class="text-sm">By: ${ann.author || 'Admin'}</span>
                        </div>
                    </div>
                `;
                announcementsList.appendChild(annEl);
            });
        }

        // Get type color for announcements
        function getTypeColor(type) {
            switch(type) {
                case 'info': return '#4ecdc4';
                case 'event': return '#45b7d1';
                case 'warning': return '#ff6b6b';
                case 'success': return '#00c6ff';
                default: return '#4ecdc4';
            }
        }

        // Get type name for announcements
        function getTypeName(type) {
            switch(type) {
                case 'info': return 'Information';
                case 'event': return 'Event';
                case 'warning': return 'Warning';
                case 'success': return 'Success';
                default: return 'Info';
            }
        }

        // Load user management (admin only)
        function loadUserManagement() {
            const userManagement = document.getElementById('user-management');
            if (userManagement) {
                userManagement.innerHTML = '';
                const table = document.createElement('table');
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Role</th>
                            <th>Class</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="user-management-body">
                        <!-- User rows will be added here -->
                    </tbody>
                `;
                userManagement.appendChild(table);
                
                const userBody = document.getElementById('user-management-body');
                userData.forEach(user => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-700';
                    row.innerHTML = `
                        <td class="py-3 px-2">${user.name}</td>
                        <td class="py-3 px-2">${user.role}</td>
                        <td class="py-3 px-2">${user.class}</td>
                        <td class="py-3 px-2">
                            <span class="user-status ${user.status === 'inactive' ? 'inactive' : ''}"></span>
                            ${user.status === 'inactive' ? 'Inactive' : 'Active'}
                        </td>
                        <td class="py-3 px-2">
                            <button class="btn btn-secondary text-xs mr-2 edit-user" data-id="${user.id}">Edit</button>
                            <button class="btn btn-primary text-xs delete-user" data-id="${user.id}">Delete</button>
                        </td>
                    `;
                    userBody.appendChild(row);
                });
                
                // Add event listeners
                document.querySelectorAll('.edit-user').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const userId = this.getAttribute('data-id');
                        editUser(userId);
                    });
                });
                
                document.querySelectorAll('.delete-user').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const userId = this.getAttribute('data-id');
                        deleteUser(userId);
                    });
                });
            }
        }

        // Edit user (admin only)
        function editUser(userId) {
            alert(`Edit user with ID: ${userId}`);
        }

        // Delete user (admin only)
        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                db.collection('users').doc(userId).delete()
                .then(() => {
                    console.log('User deleted successfully');
                    alert('User deleted successfully!');
                })
                .catch(error => {
                    console.error('Error deleting user: ', error);
                    alert('Error deleting user. Please try again.');
                });
            }
        }

        // Load messages (admin only)
        function loadMessages() {
            const messagesList = document.getElementById('messages-list');
            if (messagesList) {
                messagesList.innerHTML = '';
                const table = document.createElement('table');
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>From</th>
                            <th>Subject</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="messages-list-body">
                        <!-- Message rows will be added here -->
                    </tbody>
                `;
                messagesList.appendChild(table);
                
                const messagesBody = document.getElementById('messages-list-body');
                messagesData.forEach(msg => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-700';
                    row.innerHTML = `
                        <td class="py-3 px-2">${msg.from}</td>
                        <td class="py-3 px-2">${msg.subject}</td>
                        <td class="py-3 px-2">${formatDate(msg.date)}</td>
                        <td class="py-3 px-2">
                            <span class="badge ${msg.read ? 'completed' : 'pending'}">${msg.read ? 'Read' : 'Unread'}</span>
                        </td>
                        <td class="py-3 px-2">
                            <button class="btn btn-secondary text-xs view-message" data-id="${msg.id}">View</button>
                            <button class="btn btn-primary text-xs reply-message" data-id="${msg.id}">Reply</button>
                        </td>
                    `;
                    messagesBody.appendChild(row);
                });
                
                // Add event listeners
                document.querySelectorAll('.view-message').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const msgId = this.getAttribute('data-id');
                        viewMessage(msgId);
                    });
                });
                
                document.querySelectorAll('.reply-message').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const msgId = this.getAttribute('data-id');
                        replyToMessage(msgId);
                    });
                });
            }
        }

        // View message (admin only)
        function viewMessage(msgId) {
            const message = messagesData.find(m => m.id === msgId);
            if (message) {
                // Mark as read
                if (!message.read) {
                    db.collection('messages').doc(msgId).update({ read: true })
                    .then(() => {
                        console.log('Message marked as read');
                    })
                    .catch(error => {
                        console.error('Error marking message as read: ', error);
                    });
                }
                
                alert(`From: ${message.from}\nSubject: ${message.subject}\n\n${message.content}`);
            }
        }

        // Reply to message (admin only)
        function replyToMessage(msgId) {
            const message = messagesData.find(m => m.id === msgId);
            if (message) {
                const reply = prompt(`Reply to ${message.from}:\n\nSubject: ${message.subject}`);
                if (reply) {
                    const replyMessage = {
                        from: 'Admin',
                        to: message.from,
                        subject: `Re: ${message.subject}`,
                        content: reply,
                        date: new Date().toISOString().split('T')[0],
                        read: false,
                        type: 'reply'
                    };
                    
                    db.collection('messages').add(replyMessage)
                    .then(() => {
                        alert('Reply sent successfully!');
                    })
                    .catch(error => {
                        console.error('Error sending reply: ', error);
                        alert('Error sending reply. Please try again.');
                    });
                }
            }
        }

        // Filter homework
        function filterHomework(filter) {
            const homeworkList = document.getElementById('homework-list');
            homeworkList.innerHTML = '';
            
            let filteredHomework = homeworkData;
            if (filter !== 'all') {
                if (filter === 'pending') {
                    filteredHomework = homeworkData.filter(hw => !hw.completed);
                } else if (filter === 'completed') {
                    filteredHomework = homeworkData.filter(hw => hw.completed);
                } else {
                    filteredHomework = homeworkData.filter(hw => hw.subject === filter);
                }
            }
            
            if (filteredHomework.length === 0) {
                homeworkList.innerHTML = '<div class="text-center py-8 text-gray-400">No homework found for this category</div>';
                return;
            }
            
            filteredHomework.forEach(hw => {
                const hwEl = document.createElement('div');
                hwEl.className = `homework-item ${hw.completed ? 'completed' : ''}`;
                hwEl.style.borderLeftColor = getSubjectColor(hw.subject);
                hwEl.innerHTML = `
                    <div>
                        <h4 class="font-semibold">${hw.title}</h4>
                        <p class="text-sm text-gray-400">${hw.description}</p>
                        <div class="flex items-center gap-2 mt-2">
                            <span class="subject-tag" style="background: ${getSubjectColor(hw.subject)}">${getSubjectName(hw.subject)}</span>
                            <span class="text-sm">Due: ${formatDate(hw.dueDate)}</span>
                            <span class="text-sm">Points: ${hw.points}</span>
                            <span class="badge ${hw.completed ? 'completed' : 'pending'}">${hw.completed ? 'Completed' : 'Pending'}</span>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button class="btn-secondary text-xs view-btn" data-id="${hw.id}">View</button>
                        <button class="btn-primary text-xs complete-btn" data-id="${hw.id}">${hw.completed ? 'View' : 'Complete'}</button>
                    </div>
                `;
                homeworkList.appendChild(hwEl);
            });
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const hwId = this.getAttribute('data-id');
                    viewHomework(hwId);
                });
            });
            
            // Add event listeners to complete buttons
            document.querySelectorAll('.complete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const hwId = this.getAttribute('data-id');
                    completeHomeworkItem(hwId);
                });
            });
        }

        // Filter assignments
        function filterAssignments(filter) {
            const assignmentsList = document.getElementById('assignments-list');
            assignmentsList.innerHTML = '';
            
            let filteredAssignments = assignmentsData;
            if (filter !== 'all') {
                if (filter === 'pending') {
                    filteredAssignments = assignmentsData.filter(ass => !ass.submitted);
                } else if (filter === 'submitted') {
                    filteredAssignments = assignmentsData.filter(ass => ass.submitted);
                } else {
                    filteredAssignments = assignmentsData.filter(ass => ass.subject === filter);
                }
            }
            
            if (filteredAssignments.length === 0) {
                assignmentsList.innerHTML = '<div class="text-center py-8 text-gray-400">No assignments found for this category</div>';
                return;
            }
            
            filteredAssignments.forEach(ass => {
                const assEl = document.createElement('div');
                assEl.className = `assignment-item ${ass.submitted ? 'submitted' : ''}`;
                assEl.style.borderLeftColor = getSubjectColor(ass.subject);
                assEl.innerHTML = `
                    <div>
                        <h4 class="font-semibold">${ass.title}</h4>
                        <p class="text-sm text-gray-400">${ass.description}</p>
                        <div class="flex items-center gap-2 mt-2">
                            <span class="subject-tag" style="background: ${getSubjectColor(ass.subject)}">${getSubjectName(ass.subject)}</span>
                            <span class="text-sm">Due: ${formatDate(ass.dueDate)}</span>
                            <span class="text-sm">Points: ${ass.points}</span>
                            <span class="badge ${ass.submitted ? 'completed' : 'pending'}">${ass.submitted ? 'Submitted' : 'Pending'}</span>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button class="btn-secondary text-xs view-assignment" data-id="${ass.id}">View</button>
                        <button class="btn-primary text-xs submit-assignment" data-id="${ass.id}" ${ass.submitted ? 'disabled' : ''}>${ass.submitted ? 'Submitted' : 'Submit'}</button>
                    </div>
                `;
                assignmentsList.appendChild(assEl);
            });
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-assignment').forEach(btn => {
                btn.addEventListener('click', function() {
                    const assId = this.getAttribute('data-id');
                    viewAssignment(assId);
                });
            });
            
            // Add event listeners to submit buttons
            document.querySelectorAll('.submit-assignment:not([disabled])').forEach(btn => {
                btn.addEventListener('click', function() {
                    const assId = this.getAttribute('data-id');
                    submitAssignment(assId);
                });
            });
        }

        // View homework details
        function viewHomework(hwId) {
            const homework = homeworkData.find(hw => hw.id === hwId);
            if (homework) {
                alert(`Title: ${homework.title}\n\nDescription: ${homework.description}\n\nSubject: ${getSubjectName(homework.subject)}\nTeacher: ${homework.teacher || 'Not specified'}\nDue Date: ${formatDate(homework.dueDate)}\nPoints: ${homework.points}`);
            }
        }

        // Complete homework item
        function completeHomeworkItem(hwId) {
            const homework = homeworkData.find(hw => hw.id === hwId);
            if (homework) {
                if (homework.completed) {
                    // If already completed, just view details
                    viewHomework(hwId);
                } else {
                    // Mark as completed
                    db.collection('homework').doc(hwId).update({ 
                        completed: true, 
                        status: 'completed',
                        completedDate: new Date().toISOString().split('T')[0]
                    })
                    .then(() => {
                        console.log('Homework marked as completed');
                        
                        // Add to recent activity
                        const activity = document.getElementById('recent-activity');
                        const item = document.createElement('div');
                        item.className = 'flex items-center gap-3';
                        item.innerHTML = `
                            <div class="bg-blue-500 bg-opacity-20 p-2 rounded-full">
                                <i class="fas fa-book text-blue-400"></i>
                            </div>
                            <div class="flex-1">
                                <p class="font-medium">Homework completed: ${homework.title}</p>
                                <p class="text-sm text-gray-400">${new Date().toLocaleString()}</p>
                            </div>
                        `;
                        activity.prepend(item);
                        
                        // Show success message
                        alert('Homework marked as completed!');
                    })
                    .catch(error => {
                        console.error('Error marking homework as completed: ', error);
                        alert('Error marking homework as completed. Please try again.');
                    });
                }
            }
        }

        // View assignment details
        function viewAssignment(assId) {
            const assignment = assignmentsData.find(ass => ass.id === assId);
            if (assignment) {
                alert(`Title: ${assignment.title}\n\nDescription: ${assignment.description}\n\nSubject: ${getSubjectName(assignment.subject)}\nTeacher: ${assignment.teacher || 'Not specified'}\nDue Date: ${formatDate(assignment.dueDate)}\nPoints: ${assignment.points}`);
            }
        }

        // Submit assignment
        function submitAssignment(assId) {
            const assignment = assignmentsData.find(ass => ass.id === assId);
            if (assignment) {
                if (confirm('Are you sure you want to submit this assignment?')) {
                    db.collection('assignments').doc(assId).update({ 
                        submitted: true, 
                        status: 'submitted',
                        submittedDate: new Date().toISOString().split('T')[0]
                    })
                    .then(() => {
                        console.log('Assignment submitted successfully');
                        
                        // Add to recent activity
                        const activity = document.getElementById('recent-activity');
                        const item = document.createElement('div');
                        item.className = 'flex items-center gap-3';
                        item.innerHTML = `
                            <div class="bg-green-500 bg-opacity-20 p-2 rounded-full">
                                <i class="fas fa-clipboard-check text-green-400"></i>
                            </div>
                            <div class="flex-1">
                                <p class="font-medium">Assignment submitted: ${assignment.title}</p>
                                <p class="text-sm text-gray-400">${new Date().toLocaleString()}</p>
                            </div>
                        `;
                        activity.prepend(item);
                        
                        // Show success message
                        alert('Assignment submitted successfully!');
                    })
                    .catch(error => {
                        console.error('Error submitting assignment: ', error);
                        alert('Error submitting assignment. Please try again.');
                    });
                }
            }
        }

        // Save homework item (admin only)
        function saveHomeworkItem() {
            const title = homeworkTitle.value.trim();
            const subject = homeworkSubject.value;
            const classValue = homeworkClass.value;
            const description = homeworkDescription.value.trim();
            const dueDate = homeworkDueDate.value;
            const points = parseInt(homeworkPoints.value) || 10;
            
            if (!title || !description || !dueDate) {
                alert('Please fill in all required fields');
                return;
            }
            
            const homeworkData = {
                title,
                subject,
                class: classValue,
                description,
                dueDate,
                points,
                teacher: currentStudent.name,
                completed: false,
                status: 'pending',
                createdAt: new Date().toISOString().split('T')[0]
            };
            
            if (homeworkModalTitle.textContent === 'Add Homework') {
                // Add new homework
                db.collection('homework').add(homeworkData)
                .then(() => {
                    console.log('Homework added successfully');
                    homeworkModal.classList.add('hidden');
                    alert('Homework added successfully!');
                    
                    // Add notification for all students
                    const notification = {
                        type: 'homework',
                        title: 'New Homework Assigned',
                        content: `${getSubjectName(subject)} homework has been assigned: ${title}`,
                        date: new Date().toISOString().split('T')[0],
                        read: false
                    };
                    
                    db.collection('notifications').add(notification)
                    .then(() => {
                        console.log('Notification added successfully');
                    })
                    .catch(error => {
                        console.error('Error adding notification: ', error);
                    });
                })
                .catch(error => {
                    console.error('Error adding homework: ', error);
                    alert('Error adding homework. Please try again.');
                });
            }
        }

        // Save assignment item (admin only)
        function saveAssignmentItem() {
            const title = assignmentTitle.value.trim();
            const subject = assignmentSubject.value;
            const classValue = assignmentClass.value;
            const description = assignmentDescription.value.trim();
            const dueDate = assignmentDueDate.value;
            const points = parseInt(assignmentPoints.value) || 20;
            
            if (!title || !description || !dueDate) {
                alert('Please fill in all required fields');
                return;
            }
            
            const assignmentData = {
                title,
                subject,
                class: classValue,
                description,
                dueDate,
                points,
                teacher: currentStudent.name,
                submitted: false,
                status: 'pending',
                createdAt: new Date().toISOString().split('T')[0]
            };
            
            if (assignmentModalTitle.textContent === 'Add Assignment') {
                // Add new assignment
                db.collection('assignments').add(assignmentData)
                .then(() => {
                    console.log('Assignment added successfully');
                    assignmentModal.classList.add('hidden');
                    alert('Assignment added successfully!');
                    
                    // Add notification for all students
                    const notification = {
                        type: 'assignment',
                        title: 'New Assignment Posted',
                        content: `${getSubjectName(subject)} assignment has been posted: ${title}`,
                        date: new Date().toISOString().split('T')[0],
                        read: false
                    };
                    
                    db.collection('notifications').add(notification)
                    .then(() => {
                        console.log('Notification added successfully');
                    })
                    .catch(error => {
                        console.error('Error adding notification: ', error);
                    });
                })
                .catch(error => {
                    console.error('Error adding assignment: ', error);
                    alert('Error adding assignment. Please try again.');
                });
            }
        }

        // Post announcement item (admin only)
        function postAnnouncementItem() {
            const title = announcementTitle.value.trim();
            const type = announcementType.value;
            const content = announcementContent.value.trim();
            
            if (!title || !content) {
                alert('Please fill in all fields');
                return;
            }
            
            const announcementData = {
                title,
                type,
                content,
                date: new Date().toISOString().split('T')[0],
                author: currentStudent.name,
                class: 'all' // Announcements are for all classes
            };
            
            db.collection('announcements').add(announcementData)
            .then(() => {
                console.log('Announcement posted successfully');
                announcementModal.classList.add('hidden');
                alert('Announcement posted successfully!');
                
                // Add notification for all users
                const notification = {
                    type: 'announcement',
                    title: 'New Announcement',
                    content: `New announcement posted: ${title}`,
                    date: new Date().toISOString().split('T')[0],
                    read: false
                };
                
                db.collection('notifications').add(notification)
                .then(() => {
                    console.log('Notification added successfully');
                })
                .catch(error => {
                    console.error('Error adding notification: ', error);
                });
            })
            .catch(error => {
                console.error('Error posting announcement: ', error);
                alert('Error posting announcement. Please try again.');
            });
        }

        // Load notifications
        function loadNotifications() {
            const notificationsList = document.getElementById('notifications-list');
            notificationsList.innerHTML = '';
            
            if (notifications.length === 0) {
                notificationsList.innerHTML = '<div class="text-center py-8 text-gray-400">No notifications</div>';
                return;
            }
            
            notifications.slice(0, 20).forEach(notification => {
                const notificationEl = document.createElement('div');
                notificationEl.className = `p-3 mb-3 rounded-lg ${notification.read ? 'bg-white bg-opacity-5' : 'bg-white bg-opacity-10'}`;
                const typeColor = getNotificationColor(notification.type);
                notificationEl.innerHTML = `
                    <div class="flex items-center gap-2 mb-1">
                        <i class="fas fa-bell text-blue-400"></i>
                        <span class="font-medium">${formatDate(notification.date)}</span>
                    </div>
                    <h4 class="font-semibold">${notification.title}</h4>
                    <p class="text-sm text-gray-400 mt-1">${notification.content}</p>
                `;
                notificationsList.appendChild(notificationEl);
            });
        }

        // Get notification color
        function getNotificationColor(type) {
            switch(type) {
                case 'homework': return '#00c6ff';
                case 'assignment': return '#ff6b6b';
                case 'grade': return '#4ecdc4';
                case 'announcement': return '#45b7d1';
                default: return '#4ecdc4';
            }
        }

        // Update notification count
        function updateNotificationCount() {
            const unreadCount = notifications.filter(n => !n.read).length;
            notificationCount.textContent = unreadCount > 0 ? unreadCount : '';
        }

        // Load dashboard data
        function loadDashboardData() {
            // Calculate pending homework
            const pendingHw = homeworkData.filter(hw => !hw.completed).length;
            pendingHwEl.textContent = pendingHw;
            
            // Upcoming tests (mock data)
            upcomingTestsEl.textContent = '3';
            
            // Average grade (mock data)
            avgGradeEl.textContent = 'B+';
            
            // Attendance (mock data)
            attendanceEl.textContent = '95%';
            
            // Profile completion
            const totalHomework = homeworkData.length;
            const completedHomework = homeworkData.filter(hw => hw.completed).length;
            const completionPercent = totalHomework > 0 ? Math.round((completedHomework / totalHomework) * 100) : 0;
            profileCompletion.textContent = `${completionPercent}%`;
            profileProgress.style.width = `${completionPercent}%`;
            
            // Average grade
            profileAverage.textContent = 'B+';
        }

        // Create charts
        function createCharts() {
            // Performance Chart
            const performanceCtx = document.getElementById('performanceChart').getContext('2d');
            new Chart(performanceCtx, {
                type: 'line',
                 {
                    labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                    datasets: [{
                        label: 'Mathematics',
                        data: [85, 88, 90, 92],
                        borderColor: '#00c6ff',
                        backgroundColor: 'rgba(0, 198, 255, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Science',
                         [82, 86, 89, 91],
                        borderColor: '#4ecdc4',
                        backgroundColor: 'rgba(78, 205, 196, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'English',
                         [78, 82, 85, 88],
                        borderColor: '#ff6b6b',
                        backgroundColor: 'rgba(255, 107, 107, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: document.body.classList.contains('light-theme') ? '#333' : '#fff'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: document.body.classList.contains('light-theme') ? '#333' : '#fff'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: document.body.classList.contains('light-theme') ? '#333' : '#fff'
                            }
                        }
                    }
                }
            });
            
            // Grades Chart
            const gradesCtx = document.getElementById('gradesChart').getContext('2d');
            new Chart(gradesCtx, {
                type: 'bar',
                 {
                    labels: ['Math', 'Science', 'English', 'Social', 'Hindi'],
                    datasets: [{
                        label: 'Grades (%)',
                         [88, 85, 82, 87, 80],
                        backgroundColor: [
                            'rgba(0, 198, 255, 0.7)',
                            'rgba(78, 205, 196, 0.7)',
                            'rgba(255, 107, 107, 0.7)',
                            'rgba(255, 153, 102, 0.7)',
                            'rgba(102, 102, 255, 0.7)'
                        ],
                        borderColor: [
                            'rgba(0, 198, 255, 1)',
                            'rgba(78, 205, 196, 1)',
                            'rgba(255, 107, 107, 1)',
                            'rgba(255, 153, 102, 1)',
                            'rgba(102, 102, 255, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: document.body.classList.contains('light-theme') ? '#333' : '#fff'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: document.body.classList.contains('light-theme') ? '#333' : '#fff'
                            }
                        }
                    }
                }
            });
        }

        // Get subject color
        function getSubjectColor(subject) {
            switch(subject) {
                case 'math': return '#00c6ff';
                case 'science': return '#4ecdc4';
                case 'english': return '#ff6b6b';
                case 'social': return '#ff9966';
                case 'hindi': return '#6666ff';
                default: return '#00c6ff';
            }
        }

        // Get subject name
        function getSubjectName(subject) {
            switch(subject) {
                case 'math': return 'Mathematics';
                case 'science': return 'Science';
                case 'english': return 'English';
                case 'social': return 'Social Studies';
                case 'hindi': return 'Hindi';
                default: return subject;
            }
        }

        // Format date
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        // AI Assistant functions
        async function sendAiMessage() {
            const message = aiChatInput.value.trim();
            if (!message) return;
            
            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'message user';
            userMsg.textContent = message;
            aiChatBody.appendChild(userMsg);
            
            // Clear input
            aiChatInput.value = '';
            
            // Scroll to bottom
            aiChatBody.scrollTop = aiChatBody.scrollHeight;
            
            // Show typing indicator
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'typing';
            typingIndicator.innerHTML = `
                <span>AI is thinking</span>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            aiChatBody.appendChild(typingIndicator);
            aiChatBody.scrollTop = aiChatBody.scrollHeight;
            
            try {
                // Get AI response
                const response = await getGeminiResponse(message);
                
                // Remove typing indicator
                aiChatBody.removeChild(typingIndicator);
                
                // Add AI message
                const aiMsg = document.createElement('div');
                aiMsg.className = 'message assistant';
                aiMsg.textContent = response;
                aiChatBody.appendChild(aiMsg);
                
                // Scroll to bottom
                aiChatBody.scrollTop = aiChatBody.scrollHeight;
            } catch (error) {
                // Remove typing indicator
                aiChatBody.removeChild(typingIndicator);
                
                // Add error message
                const aiMsg = document.createElement('div');
                aiMsg.className = 'message assistant';
                aiMsg.textContent = "I'm sorry, I'm having trouble connecting to the AI service right now. Please try again later.";
                aiChatBody.appendChild(aiMsg);
                
                // Scroll to bottom
                aiChatBody.scrollTop = aiChatBody.scrollHeight;
            }
        }

        // Get Gemini response
        async function getGeminiResponse(prompt) {
            try {
                const response = await fetch('https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent?key=AIzaSyCqGS8gb5kh7Jr0pv8d84LxCLhgHU-O_VU', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `You are helping ${currentStudent.name} from Class ${currentStudent.class}. ${prompt}`
                            }]
                        }]
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to get response from Gemini API');
                }
                
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                throw error;
            }
        }

        // Network status monitoring
        window.addEventListener('online', () => {
            isOnline = true;
            console.log('Back online');
        });

        window.addEventListener('offline', () => {
            isOnline = false;
            alert('You are now offline. Some features may not work until you reconnect.');
        });

        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
