<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#0d6efd" />
    <title>Student Dashboard | School Web #1</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --p: #0d6efd;
            --s: #6c757d;
            --l: #f8f9fa;
            --d: #212529;
            --a: #ffc107;
            --bg: #fff;
            --card: #f1f3f5;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
            --border: #ddd;
            --success: #198754;
            --danger: #dc3545;
            --warning: #fd7e14;
            --info: #0dcaf0;
        }

        .dark-mode {
            --bg: #121212;
            --card: #1e1e1e;
            --d: #e0e0e0;
            --border: #333;
            --shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            background: var(--bg);
            color: var(--d);
            min-height: 100vh;
            position: relative;
            padding-bottom: 80px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 15px 0;
            margin-bottom: 20px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--p);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo i {
            font-size: 1.8rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .user-info .name {
            font-weight: 600;
        }

        .user-info .class {
            background: var(--p);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
        }

        .main-content {
            margin-bottom: 20px;
        }

        .welcome-card {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--p);
        }

        .welcome-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .welcome-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--d);
        }

        .date-info {
            font-size: 0.85rem;
            color: var(--s);
        }

        .homework-section {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--d);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title i {
            color: var(--p);
        }

        .homework-list {
            list-style: none;
        }

        .homework-item {
            padding: 15px;
            margin-bottom: 10px;
            background: var(--bg);
            border-radius: 8px;
            border-left: 3px solid var(--p);
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
        }

        .homework-item:last-child {
            margin-bottom: 0;
        }

        .homework-emoji {
            font-size: 1.5rem;
        }

        .homework-text {
            flex: 1;
        }

        .homework-subject {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .homework-desc {
            font-size: 0.9rem;
            color: var(--s);
        }

        .homework-due {
            font-size: 0.8rem;
            background: var(--info);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
        }

        .ai-chat {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chat-title {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chat-title i {
            color: var(--success);
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            background: #28a745;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }

        .status-online {
            background: #28a745;
        }

        .status-offline {
            background: #dc3545;
        }

        .chat-messages {
            height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 10px;
            background: var(--bg);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .message {
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 18px;
            max-width: 80%;
            line-height: 1.4;
            font-size: 0.9rem;
        }

        .message.user {
            background: var(--p);
            color: white;
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .message.ai {
            background: var(--bg);
            color: var(--d);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .message-container {
            display: flex;
            margin-bottom: 10px;
        }

        .message-container.user {
            justify-content: flex-end;
        }

        .message-container.ai {
            justify-content: flex-start;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            outline: none;
            background: var(--bg);
            color: var(--d);
        }

        .chat-input:focus {
            border-color: var(--p);
            box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25);
        }

        .send-btn {
            padding: 0 20px;
            background: var(--p);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-btn i {
            font-size: 1.2rem;
        }

        .menu-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--p);
            cursor: pointer;
            padding: 8px;
        }

        .menu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 280px;
            height: 100%;
            background: var(--card);
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .menu.open {
            right: 0;
        }

        .menu-header {
            display: flex;
            align-items: center;
            padding-bottom: 15px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .menu-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--s);
            cursor: pointer;
            margin-left: auto;
        }

        .menu-list {
            list-style: none;
        }

        .menu-item {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--d);
            cursor: pointer;
            font-size: 0.95rem;
        }

        .menu-item:hover {
            background: rgba(13, 110, 253, 0.1);
            border-radius: 8px;
        }

        .menu-item i {
            font-size: 1.2rem;
            color: var(--p);
        }

        .menu-divider {
            height: 1px;
            background: var(--border);
            margin: 15px 0;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .overlay.active {
            display: block;
        }

        .fab {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: var(--p);
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 99;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }

        .fab.show {
            opacity: 1;
            transform: translateY(0);
        }

        .fab i {
            font-size: 1.5rem;
        }

        .offline-banner {
            position: fixed;
            top: -60px;
            left: 0;
            width: 100%;
            background: var(--danger);
            color: white;
            text-align: center;
            padding: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            z-index: 100;
            transition: top 0.3s ease;
        }

        .offline-banner.active {
            top: 0;
        }

        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--card);
            padding: 15px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 98;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .footer-text {
            font-size: 0.8rem;
            color: var(--s);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn i {
            font-size: 1.1rem;
        }

        .btn-primary {
            background: var(--p);
            color: white;
        }

        .btn-outline {
            background: transparent;
            color: var(--p);
            border: 1px solid var(--p);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--card);
            width: 90%;
            max-width: 400px;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--s);
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--d);
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg);
            color: var(--d);
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--p);
            box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25);
        }

        .btn-block {
            width: 100%;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1002;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.danger {
            background: var(--danger);
        }

        .toast.warning {
            background: var(--warning);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            header {
                padding: 10px;
            }

            .welcome-card, .homework-section, .ai-chat {
                padding: 15px;
            }

            .homework-item {
                padding: 12px;
            }

            .chat-messages {
                height: 150px;
            }

            .fab {
                width: 45px;
                height: 45px;
                right: 15px;
                bottom: 85px;
            }

            footer {
                padding: 12px 0;
            }

            .footer-content {
                gap: 10px;
            }

            .action-buttons {
                gap: 5px;
            }

            .btn {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            .btn i {
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 1.3rem;
            }

            .user-info {
                display: none;
            }

            .welcome-title {
                font-size: 1.1rem;
            }

            .section-title {
                font-size: 1rem;
            }

            .homework-item {
                gap: 8px;
            }

            .homework-emoji {
                font-size: 1.3rem;
            }

            .homework-desc {
                font-size: 0.85rem;
            }

            .chat-title {
                font-size: 1rem;
            }

            .message {
                font-size: 0.85rem;
                padding: 8px 12px;
            }

            .chat-input {
                padding: 10px 12px;
            }

            .send-btn {
                padding: 0 15px;
            }

            .menu {
                width: 100%;
            }

            .fab {
                width: 40px;
                height: 40px;
                right: 15px;
                bottom: 80px;
            }

            .toast {
                top: 15px;
                right: 15px;
                padding: 12px 15px;
                font-size: 0.85rem;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .slide-up {
            animation: slideUp 0.5s ease-out;
        }

        /* Icons using pseudo-elements */
        .icon-home::before {
            content: "🏠";
        }
        .icon-print::before {
            content: "🖨️";
        }
        .icon-share::before {
            content: "📤";
        }
        .icon-theme::before {
            content: "🌓";
        }
        .icon-app::before {
            content: "📱";
        }
        .icon-clear::before {
            content: "🧹";
        }
        .icon-admin::before {
            content: "🔐";
        }
        .icon-logout::before {
            content: "🚪";
        }
        .icon-top::before {
            content: "⬆️";
        }
        .icon-chat::before {
            content: "💬";
        }
        .icon-homework::before {
            content: "📚";
        }
        .icon-math::before {
            content: "➗";
        }
        .icon-science::before {
            content: "🔬";
        }
        .icon-english::before {
            content: "📖";
        }
        .icon-history::before {
            content: "🏛️";
        }
        .icon-art::before {
            content: "🎨";
        }
        .icon-sports::before {
            content: "⚽";
        }
        .icon-download::before {
            content: "⬇️";
        }
        .icon-pdf::before {
            content: "📄";
        }
        .icon-notification::before {
            content: "🔔";
        }
        .icon-menu::before {
            content: "☰";
        }
        .icon-send::before {
            content: "➡️";
        }
        .icon-close::before {
            content: "×";
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* PDF Viewer */
        .pdf-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1003;
            flex-direction: column;
        }

        .pdf-container.active {
            display: flex;
        }

        .pdf-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #333;
            color: white;
        }

        .pdf-title {
            font-weight: 600;
        }

        .pdf-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .pdf-embed {
            flex: 1;
            border: none;
        }

        /* Notification permission modal */
        .notif-permission {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--card);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            max-width: 300px;
            display: none;
            animation: slideUp 0.3s ease-out;
        }

        .notif-permission p {
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: var(--d);
        }

        .notif-buttons {
            display: flex;
            gap: 10px;
        }

        .notif-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .notif-btn.yes {
            background: var(--p);
            color: white;
        }

        .notif-btn.no {
            background: var(--border);
            color: var(--d);
        }
    </style>
</head>
<body>
    <!-- Offline Banner -->
    <div class="offline-banner" id="offlineBanner">
        You are offline. Some features may not work.
    </div>

    <!-- Header -->
    <header>
        <div class="logo">
            <span>🏫</span>
            <span>School Web</span>
        </div>
        <button class="menu-btn" id="menuBtn">
            <span class="icon-menu"></span>
        </button>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="user-info">
            <span class="name" id="userName">Student</span>
            <span class="class" id="userClass">Class X</span>
        </div>

        <div class="main-content">
            <!-- Welcome Card -->
            <div class="welcome-card fade-in">
                <div class="welcome-header">
                    <h2 class="welcome-title">Good morning! 🌞</h2>
                    <span class="date-info" id="currentDate">Loading...</span>
                </div>
                <p>Here's what you need to do today. Stay focused and keep up the great work! 💪</p>
            </div>

            <!-- Homework Section -->
            <div class="homework-section slide-up">
                <h3 class="section-title">
                    <span class="icon-homework"></span>
                    Today's Homework
                </h3>
                <ul class="homework-list" id="homeworkList">
                    <!-- Homework items will be added here -->
                </ul>
            </div>

            <!-- AI Chat Section -->
            <div class="ai-chat slide-up">
                <div class="chat-header">
                    <h3 class="chat-title">
                        <span class="icon-chat"></span>
                        School AI Assistant
                        <span class="status-indicator" id="aiStatus"></span>
                        <span id="aiStatusText">Online</span>
                    </h3>
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message-container ai">
                        <div class="message ai">
                            Hello! I'm your school AI assistant. How can I help you with your studies today? 📚
                        </div>
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Ask about homework, subjects, or school info..." />
                    <button class="send-btn" id="sendBtn">
                        <span class="icon-send"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-text">© 2023 School Web. All rights reserved.</div>
            <div class="action-buttons">
                <button class="btn btn-outline" id="downloadPdfBtn">
                    <span class="icon-pdf"></span>
                    PDF
                </button>
                <button class="btn btn-primary" id="notifyBtn">
                    <span class="icon-notification"></span>
                    Notify
                </button>
            </div>
        </div>
    </footer>

    <!-- Floating Action Button -->
    <button class="fab" id="scrollTopBtn">
        <span class="icon-top"></span>
    </button>

    <!-- Menu -->
    <div class="overlay" id="overlay"></div>
    <div class="menu" id="menu">
        <div class="menu-header">
            <h3>Menu</h3>
            <button class="menu-close" id="menuClose">
                <span class="icon-close"></span>
            </button>
        </div>
        <ul class="menu-list">
            <li class="menu-item" id="printItem">
                <span class="icon-print"></span>
                Print Dashboard
            </li>
            <li class="menu-item" id="shareItem">
                <span class="icon-share"></span>
                Share
            </li>
            <li class="menu-item" id="themeItem">
                <span class="icon-theme"></span>
                Dark Mode
            </li>
            <li class="menu-item" id="installItem">
                <span class="icon-app"></span>
                Install App
            </li>
            <li class="menu-item" id="clearCacheItem">
                <span class="icon-clear"></span>
                Clear Cache
            </li>
            <li class="menu-divider"></li>
            <li class="menu-item" id="adminItem">
                <span class="icon-admin"></span>
                Admin Panel
            </li>
            <li class="menu-item" id="logoutItem">
                <span class="icon-logout"></span>
                Logout
            </li>
        </ul>
    </div>

    <!-- Toast Notifications -->
    <div class="toast" id="toast">
        <span id="toastMessage">This is a toast message</span>
    </div>

    <!-- Modals -->
    <div class="modal" id="passwordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Admin Access</h3>
                <button class="modal-close" id="closePasswordModal">×</button>
            </button>
            </div>
            <div class="form-group">
                <label for="adminPassword">Enter Password</label>
                <input type="password" class="form-control" id="adminPassword" placeholder="Enter admin password" />
            </div>
            <button class="btn btn-block btn-primary" id="submitPassword">Submit</button>
        </div>
    </div>

    <div class="modal" id="clearCacheModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Clear Cache</h3>
                <button class="modal-close" id="closeClearCacheModal">×</button>
            </button>
            </div>
            <p>Are you sure you want to clear all cached data? This will remove stored homework, settings, and other local data.</p>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="btn btn-outline" id="cancelClear">Cancel</button>
                <button class="btn btn-danger btn-block" id="confirmClear">Clear Cache</button>
            </div>
        </div>
    </div>

    <!-- PDF Viewer -->
    <div class="pdf-container" id="pdfContainer">
        <div class="pdf-header">
            <span class="pdf-title">Homework Summary</span>
            <button class="pdf-close" id="closePdf">✕</button>
        </div>
        <iframe src="" class="pdf-embed" id="pdfEmbed"></iframe>
    </div>

    <!-- Notification Permission -->
    <div class="notif-permission" id="notifPermission">
        <p>Enable notifications to receive homework reminders and updates?</p>
        <div class="notif-buttons">
            <button class="notif-btn yes" id="allowNotif">Allow</button>
            <button class="notif-btn no" id="denyNotif">Not now</button>
        </div>
    </div>

    <script>
        // App state
        const state = {
            user: {
                name: '',
                cls: '',
                parent: ''
            },
            darkMode: false,
            aiOnline: true,
            homework: [],
            chatHistory: [],
            notificationPermission: false,
            installPrompt: null
        };

        // DOM Elements
        const elements = {
            userName: document.getElementById('userName'),
            userClass: document.getElementById('userClass'),
            currentDate: document.getElementById('currentDate'),
            homeworkList: document.getElementById('homeworkList'),
            chatMessages: document.getElementById('chatMessages'),
            chatInput: document.getElementById('chatInput'),
            sendBtn: document.getElementById('sendBtn'),
            menuBtn: document.getElementById('menuBtn'),
            menu: document.getElementById('menu'),
            overlay: document.getElementById('overlay'),
            menuClose: document.getElementById('menuClose'),
            scrollTopBtn: document.getElementById('scrollTopBtn'),
            offlineBanner: document.getElementById('offlineBanner'),
            aiStatus: document.getElementById('aiStatus'),
            aiStatusText: document.getElementById('aiStatusText'),
            toast: document.getElementById('toast'),
            passwordModal: document.getElementById('passwordModal'),
            closePasswordModal: document.getElementById('closePasswordModal'),
            adminPassword: document.getElementById('adminPassword'),
            submitPassword: document.getElementById('submitPassword'),
            clearCacheModal: document.getElementById('clearCacheModal'),
            closeClearCacheModal: document.getElementById('closeClearCacheModal'),
            cancelClear: document.getElementById('cancelClear'),
            confirmClear: document.getElementById('confirmClear'),
            downloadPdfBtn: document.getElementById('downloadPdfBtn'),
            notifyBtn: document.getElementById('notifyBtn'),
            pdfContainer: document.getElementById('pdfContainer'),
            pdfEmbed: document.getElementById('pdfEmbed'),
            closePdf: document.getElementById('closePdf'),
            notifPermission: document.getElementById('notifPermission'),
            allowNotif: document.getElementById('allowNotif'),
            denyNotif: document.getElementById('denyNotif')
        };

        // Menu Items
        const menuItems = {
            printItem: document.getElementById('printItem'),
            shareItem: document.getElementById('shareItem'),
            themeItem: document.getElementById('themeItem'),
            installItem: document.getElementById('installItem'),
            clearCacheItem: document.getElementById('clearCacheItem'),
            adminItem: document.getElementById('adminItem'),
            logoutItem: document.getElementById('logoutItem')
        };

        // Initialize the app
        function init() {
            loadUserData();
            setupEventListeners();
            generateHomework();
            updateDate();
            checkOnlineStatus();
            loadDarkMode();
            showNotificationPrompt();
            setupAIResponses();
            updateInstallButton();
        }

        // Load user data from localStorage
        function loadUserData() {
            try {
                state.user.name = localStorage.getItem('name') || 'Student';
                state.user.cls = localStorage.getItem('cls') || 'X';
                state.user.parent = localStorage.getItem('parent') || '';

                elements.userName.textContent = state.user.name;
                elements.userClass.textContent = `Class ${state.user.cls}`;
            } catch (error) {
                showToast('Error loading user data', 'danger');
                console.error('Error loading user data:', error);
            }
        }

        // Setup all event listeners
        function setupEventListeners() {
            // Menu toggle
            elements.menuBtn.addEventListener('click', toggleMenu);
            elements.menuClose.addEventListener('click', closeMenu);
            elements.overlay.addEventListener('click', closeMenu);

            // Menu items
            menuItems.printItem.addEventListener('click', printDashboard);
            menuItems.shareItem.addEventListener('click', shareDashboard);
            menuItems.themeItem.addEventListener('click', toggleDarkMode);
            menuItems.installItem.addEventListener('click', installApp);
            menuItems.clearCacheItem.addEventListener('click', showClearCacheModal);
            menuItems.adminItem.addEventListener('click', showPasswordModal);
            menuItems.logoutItem.addEventListener('click', logout);

            // Chat functionality
            elements.sendBtn.addEventListener('click', sendChatMessage);
            elements.chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });

            // Scroll to top
            elements.scrollTopBtn.addEventListener('click', scrollToTop);
            window.addEventListener('scroll', toggleScrollButton);

            // Online/Offline events
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);

            // PDF and notifications
            elements.downloadPdfBtn.addEventListener('click', generatePDF);
            elements.notifyBtn.addEventListener('click', sendNotification);
            elements.closePdf.addEventListener('click', () => {
                elements.pdfContainer.classList.remove('active');
            });

            // Modal events
            elements.closePasswordModal.addEventListener('click', closePasswordModal);
            elements.submitPassword.addEventListener('click', verifyPassword);
            elements.closeClearCacheModal.addEventListener('click', closeClearCacheModal);
            elements.cancelClear.addEventListener('click', closeClearCacheModal);
            elements.confirmClear.addEventListener('click', clearAllCache);

            // Notification permission
            elements.allowNotif.addEventListener('click', () => {
                requestNotificationPermission();
                elements.notifPermission.style.display = 'none';
            });
            elements.denyNotif.addEventListener('click', () => {
                elements.notifPermission.style.display = 'none';
            });

            // PWA install prompt
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                state.installPrompt = e;
                updateInstallButton();
            });

            window.addEventListener('appinstalled', () => {
                state.installPrompt = null;
                updateInstallButton();
                showToast('App installed successfully! 🎉', 'success');
            });
        }

        // Toggle menu
        function toggleMenu() {
            elements.menu.classList.toggle('open');
            elements.overlay.classList.toggle('active');
        }

        function closeMenu() {
            elements.menu.classList.remove('open');
            elements.overlay.classList.remove('active');
        }

        // Print dashboard
        function printDashboard() {
            closeMenu();
            showToast('Preparing print preview...', 'info');
            setTimeout(() => {
                window.print();
            }, 500);
        }

        // Share dashboard
        function shareDashboard() {
            closeMenu();
            if (navigator.share) {
                navigator.share({
                    title: 'My School Dashboard',
                    text: `Check out my school dashboard! Homework and AI assistance all in one place. 📚`,
                    url: window.location.href
                }).then(() => {
                    showToast('Shared successfully!', 'success');
                }).catch(() => {
                    showToast('Share cancelled', 'warning');
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                copyToClipboard(window.location.href);
                showToast('Link copied to clipboard!', 'success');
            }
        }

        // Copy text to clipboard
        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text);
            } else {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            }
        }

        // Toggle dark mode
        function toggleDarkMode() {
            closeMenu();
            state.darkMode = !state.darkMode;
            document.body.classList.toggle('dark-mode', state.darkMode);
            localStorage.setItem('darkMode', state.darkMode);
            updateThemeIcon();
            showToast(state.darkMode ? 'Dark mode enabled 🌙' : 'Light mode enabled ☀️', 'info');
        }

        // Update theme icon in menu
        function updateThemeIcon() {
            const icon = menuItems.themeItem.querySelector('.icon-theme');
            icon.textContent = state.darkMode ? '☀️' : '🌙';
        }

        // Load dark mode preference
        function loadDarkMode() {
            const savedMode = localStorage.getItem('darkMode');
            state.darkMode = savedMode === 'true';
            document.body.classList.toggle('dark-mode', state.darkMode);
            updateThemeIcon();
        }

        // Install PWA app
        function installApp() {
            closeMenu();
            if (state.installPrompt) {
                state.installPrompt.prompt();
                state.installPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        showToast('App installation started! 📱', 'success');
                    }
                    state.installPrompt = null;
                    updateInstallButton();
                });
            } else {
                showToast('Add to home screen from browser menu', 'warning');
            }
        }

        // Update install button text
        function updateInstallButton() {
            const text = state.installPrompt ? 'Install App' : 'App Installed';
            menuItems.installItem.innerHTML = `<span class="icon-app"></span> ${text}`;
            menuItems.installItem.style.opacity = state.installPrompt ? '1' : '0.6';
        }

        // Show clear cache modal
        function showClearCacheModal() {
            closeMenu();
            elements.clearCacheModal.classList.add('active');
        }

        function closeClearCacheModal() {
            elements.clearCacheModal.classList.remove('active');
        }

        // Clear all cache
        function clearAllCache() {
            try {
                // Clear localStorage
                localStorage.clear();
                
                // Clear any cached data
                state.homework = [];
                state.chatHistory = [];
                
                // Update UI
                elements.homeworkList.innerHTML = '';
                elements.chatMessages.innerHTML = `
                    <div class="message-container ai">
                        <div class="message ai">
                            Cache cleared successfully! You'll need to log in again. 😊
                        </div>
                    </div>
                `;
                
                closeClearCacheModal();
                showToast('Cache cleared! Logging out...', 'success');
                
                // Redirect to login
                setTimeout(() => {
                    logout();
                }, 2000);
                
            } catch (error) {
                showToast('Error clearing cache', 'danger');
                console.error('Error clearing cache:', error);
            }
        }

        // Show password modal for admin
        function showPasswordModal() {
            closeMenu();
            elements.passwordModal.classList.add('active');
            elements.adminPassword.value = '';
        }

        function closePasswordModal() {
            elements.passwordModal.classList.remove('active');
        }

        // Verify admin password
        function verifyPassword() {
            const password = elements.adminPassword.value.trim();
            if (password === 'Abutalha') {
                closePasswordModal();
                showToast('Admin access granted! 🔐', 'success');
                // Redirect to admin panel
                setTimeout(() => {
                    window.location.href = 'admin.html';
                }, 1000);
            } else {
                showToast('Incorrect password!', 'danger');
                elements.adminPassword.value = '';
            }
        }

        // Logout
        function logout() {
            try {
                localStorage.removeItem('name');
                localStorage.removeItem('cls');
                localStorage.removeItem('parent');
                showToast('Logged out successfully', 'info');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
            } catch (error) {
                console.error('Error during logout:', error);
                window.location.href = 'index.html';
            }
        }

        // Send chat message
        function sendChatMessage() {
            const message = elements.chatInput.value.trim();
            if (!message) return;

            // Add user message
            addChatMessage(message, 'user');
            elements.chatInput.value = '';

            // Simulate AI thinking
            setTimeout(() => {
                const aiResponse = getAIResponse(message);
                addChatMessage(aiResponse, 'ai');
            }, 600);
        }

        // Add message to chat
        function addChatMessage(text, sender) {
            const messageContainer = document.createElement('div');
            messageContainer.className = `message-container ${sender}`;
            
            const message = document.createElement('div');
            message.className = `message ${sender}`;
            message.textContent = text;
            
            messageContainer.appendChild(message);
            elements.chatMessages.appendChild(messageContainer);
            
            // Scroll to bottom
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
            
            // Save to history
            state.chatHistory.push({ text, sender });
        }

        // AI responses - never repeats the same canned answer
        const aiResponses = {
            math: [
                "Let's solve this math problem together! 🧮 Remember to show your work step by step.",
                "Math is all about patterns! Look for the sequence and you'll find the answer. 🔍",
                "Don't forget your order of operations: PEMDAS! Parentheses first. 📐",
                "Try drawing a diagram to visualize the math problem. It often helps! 🖍️",
                "Check your calculations twice - accuracy matters in math! ✅",
                "Break down complex equations into smaller parts. You've got this! 💪",
                "Remember, practice makes perfect in mathematics. Keep working at it! 📈"
            ],
            science: [
                "Science is all about observation and experimentation! 🔬 What hypothesis can you form?",
                "Remember the scientific method: Question, Hypothesis, Experiment, Conclusion! 🧪",
                "Look for patterns in your data - they often reveal important insights! 📊",
                "Safety first in the lab! Always wear your goggles and follow procedures. 👓",
                "The natural world is full of wonders. What questions does this make you curious about? 🌍",
                "Document your observations carefully - details matter in science! 📝",
                "Think like a scientist: be skeptical, test assumptions, and seek evidence! 🔎"
            ],
            english: [
                "Great writing comes from reading widely and practicing regularly! 📖",
                "Vary your sentence structure to make your writing more engaging! ✍️",
                "Show, don't tell! Use vivid descriptions to bring your writing to life. 🎨",
                "Proofread carefully - even small errors can distract readers. 🔍",
                "Find your unique voice in your writing. Authenticity shines through! 🗣️",
                "Expand your vocabulary by noting interesting words you encounter. 📚",
                "Structure your essay with a clear introduction, body, and conclusion. 🏗️"
            ],
            history: [
                "History teaches us valuable lessons about human nature and society. 🕰️",
                "Consider the context of historical events - what was happening around them? 🌐",
                "Primary sources offer direct windows into the past. Analyze them critically! 📜",
                "Look for cause and effect relationships in historical developments. 🔗",
                "Different perspectives can give us fuller understanding of historical events. 👥",
                "Maps are essential tools for understanding historical movements and changes. 🗺️",
                "The past is prologue - how do historical events shape our present? 🔮"
            ],
            general: [
                "I'm here to help with your schoolwork! Ask me about any subject. 📚",
                "Remember to manage your time effectively for all your assignments. ⏳",
                "Break large tasks into smaller, manageable chunks. Progress builds confidence! 🧱",
                "Don't hesitate to ask teachers for clarification when needed. They're here to help! 🙋",
                "Form study groups with classmates - teaching others reinforces your own learning! 👥",
                "Take regular breaks during study sessions to maintain focus and prevent burnout. ☕",
                "Celebrate your academic achievements, no matter how small! Every step forward counts. 🎉",
                "Organization is key to academic success. Keep your materials and schedule in order. 🗂️",
                "Your effort matters more than perfection. Keep trying and you will improve! 💯",
                "Connect new information to what you already know - it aids retention. 🔗",
                "Stay curious! The desire to learn will serve you well throughout life. 🔍",
                "Mistakes are opportunities to learn. Analyze them and grow stronger. 🌱",
                "Set specific, achievable goals for your studies. Track your progress! 🎯",
                "Your education is an investment in your future self. Stay committed! 💼",
                "Balance is important - make time for both studies and relaxation. ⚖️"
            ],
            homework: [
                "Start with the most challenging assignment while your mind is fresh! 🧠",
                "Review your class notes before beginning homework to refresh key concepts. 📓",
                "Set a timer for focused work sessions - try the Pomodoro technique! ⏱️",
                "Keep your workspace organized and free from distractions. 🧹",
                "If you're stuck, take a short break and come back with fresh eyes. 🚶",
                "Complete assignments as soon as possible to avoid last-minute stress. 📅",
                "Double-check all your work before submission - attention to detail counts! ✅",
                "Use homework as an opportunity to identify what you need more practice with. 🎯"
            ]
        };

        let usedResponses = {
            math: [],
            science: [],
            english: [],
            history: [],
            general: [],
            homework: []
        };

        // Get AI response based on message content
        function getAIResponse(message) {
            message = message.toLowerCase();
            
            // Reset used responses if all have been used
            Object.keys(usedResponses).forEach(category => {
                if (usedResponses[category].length >= aiResponses[category].length) {
                    usedResponses[category] = [];
                }
            });
            
            // Determine category based on keywords
            let category = 'general';
            let responses = aiResponses.general;
            
            if (message.includes('math') || message.includes('calculate') || message.includes('number') || 
                message.includes('equation') || message.includes('problem')) {
                category = 'math';
                responses = aiResponses.math;
            } else if (message.includes('science') || message.includes('experiment') || 
                      message.includes('lab') || message.includes('biology') || message.includes('chemistry')) {
                category = 'science';
                responses = aiResponses.science;
            } else if (message.includes('english') || message.includes('write') || 
                      message.includes('essay') || message.includes('grammar') || message.includes('read')) {
                category = 'english';
                responses = aiResponses.english;
            } else if (message.includes('history') || message.includes('past') || 
                      message.includes('ancient') || message.includes('war') || message.includes('country')) {
                category = 'history';
                responses = aiResponses.history;
            } else if (message.includes('homework') || message.includes('assignment') || 
                      message.includes('due') || message.includes('task')) {
                category = 'homework';
                responses = aiResponses.homework;
            }
            
            // Filter out already used responses
            const availableResponses = responses.filter(r => !usedResponses[category].includes(r));
            
            // If all responses have been used, reset the list
            if (availableResponses.length === 0) {
                usedResponses[category] = [];
                return getRandomItem(responses);
            }
            
            // Get random response from available ones
            const response = getRandomItem(availableResponses);
            usedResponses[category].push(response);
            
            return response;
        }

        // Get random item from array
        function getRandomItem(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        // Generate homework based on class
        function generateHomework() {
            const classNum = parseInt(state.user.cls) || 1;
            const subjects = [
                { name: 'Mathematics', emoji: '➗', key: 'math' },
                { name: 'Science', emoji: '🔬', key: 'science' },
                { name: 'English', emoji: '📖', key: 'english' },
                { name: 'History', emoji: '🏛️', key: 'history' },
                { name: 'Art', emoji: '🎨', key: 'art' },
                { name: 'Physical Education', emoji: '⚽', key: 'sports' }
            ];
            
            // Clear existing homework
            elements.homeworkList.innerHTML = '';
            state.homework = [];
            
            // Generate homework for 3-4 subjects based on class level
            const numSubjects = classNum <= 5 ? 3 : classNum <= 8 ? 4 : 5;
            const selectedSubjects = getRandomUniqueItems(subjects, numSubjects);
            
            selectedSubjects.forEach(subject => {
                const homework = generateHomeworkForSubject(subject, classNum);
                state.homework.push(homework);
                addHomeworkItem(homework);
            });
            
            // If no homework generated, add a default
            if (state.homework.length === 0) {
                const defaultHomework = {
                    subject: 'Mathematics',
                    emoji: '➗',
                    description: 'Practice multiplication tables 1-12',
                    due: 'Tomorrow'
                };
                state.homework.push(defaultHomework);
                addHomeworkItem(defaultHomework);
            }
        }

        // Get random unique items from array
        function getRandomUniqueItems(array, count) {
            const shuffled = [...array].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        // Generate homework for a specific subject
        function generateHomeworkForSubject(subject, classLevel) {
            const mathTasks = [
                'Complete exercises 1-15 on page 45',
                'Solve 10 word problems involving fractions',
                'Practice multiplication tables 6-9',
                'Work on geometry problems involving area and perimeter',
                'Complete the algebra worksheet',
                'Review for the upcoming math test',
                'Solve 5 equations with variables on both sides',
                'Work on percentage and discount problems'
            ];
            
            const scienceTasks = [
                'Complete the lab report on plant cells',
                'Research and write about the water cycle',
                'Prepare for the science quiz on ecosystems',
                'Draw and label the parts of a flower',
                'Conduct a home experiment and document results',
                'Research renewable energy sources',
                'Study for the astronomy test',
                'Complete the worksheet on states of matter'
            ];
            
            const englishTasks = [
                'Write a 300-word story using 10 vocabulary words',
                'Read Chapter 7 and answer comprehension questions',
                'Complete the grammar worksheet on punctuation',
                'Write a persuasive essay on a topic of your choice',
                'Practice spelling words for the weekly test',
                'Analyze the poem discussed in class',
                'Work on your creative writing journal',
                'Prepare for the reading comprehension test'
            ];
            
            const historyTasks = [
                'Read about ancient civilizations and take notes',
                'Create a timeline of important events',
                'Research a historical figure and prepare a presentation',
                'Answer questions about the American Revolution',
                'Study for the geography quiz',
                'Write a paragraph about cultural traditions',
                'Complete the worksheet on government systems',
                'Research famous explorers and their discoveries'
            ];
            
            const artTasks = [
                'Draw a landscape using pencil shading techniques',
                'Create a collage using magazine cutouts',
                'Paint a scene using watercolors',
                'Sculpt a figure using clay or playdough',
                'Design a poster for a school event',
                'Sketch from observation for 30 minutes',
                'Create a self-portrait',
                'Experiment with color mixing'
            ];
            
            const sportsTasks = [
                'Practice dribbling and passing for 20 minutes',
                'Run one mile and record your time',
                'Practice free throws - 50 attempts',
                'Learn and practice a new dance routine',
                'Do 3 sets of 15 push-ups and sit-ups',
                'Practice yoga or stretching exercises',
                'Play a sport with friends for 30 minutes',
                'Record your physical activity for the week'
            ];
            
            let task = '';
            let due = 'Tomorrow';
            
            // Select task based on subject
            switch (subject.key) {
                case 'math':
                    task = getRandomItem(mathTasks);
                    break;
                case 'science':
                    task = getRandomItem(scienceTasks);
                    break;
                case 'english':
                    task = getRandomItem(englishTasks);
                    break;
                case 'history':
                    task = getRandomItem(historyTasks);
                    break;
                case 'art':
                    task = getRandomItem(artTasks);
                    break;
                case 'sports':
                    task = getRandomItem(sportsTasks);
                    break;
                default:
                    task = 'Complete the assigned worksheet';
            }
            
            // Adjust due date based on class level and day of week
            const today = new Date().getDay(); // 0 = Sunday, 6 = Saturday
            if (today === 5) { // Friday
                due = 'Monday';
            } else if (today === 6) { // Saturday
                due = 'Monday';
            } else {
                due = 'Tomorrow';
            }
            
            // For higher grades, sometimes assign longer deadlines
            if (classLevel > 8 && Math.random() > 0.7) {
                due = 'in 3 days';
            }
            
            return {
                subject: subject.name,
                emoji: subject.emoji,
                description: task,
                due: due
            };
        }

        // Add homework item to the list
        function addHomeworkItem(homework) {
            const li = document.createElement('li');
            li.className = 'homework-item';
            li.innerHTML = `
                <span class="homework-emoji">${homework.emoji}</span>
                <div class="homework-text">
                    <div class="homework-subject">${homework.subject}</div>
                    <div class="homework-desc">${homework.description}</div>
                </div>
                <span class="homework-due">${homework.due}</span>
            `;
            elements.homeworkList.appendChild(li);
        }

        // Update current date
        function updateDate() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const today = new Date();
            elements.currentDate.textContent = today.toLocaleDateString(undefined, options);
        }

        // Check online status
        function checkOnlineStatus() {
            updateOnlineStatus();
            setInterval(updateOnlineStatus, 30000); // Check every 30 seconds
        }

        // Update online/offline status
        function updateOnlineStatus() {
            const isOnline = navigator.onLine;
            if (isOnline) {
                elements.offlineBanner.classList.remove('active');
                state.aiOnline = true;
                elements.aiStatus.classList.add('status-online');
                elements.aiStatus.classList.remove('status-offline');
                elements.aiStatusText.textContent = 'Online';
            } else {
                elements.offlineBanner.classList.add('active');
                state.aiOnline = false;
                elements.aiStatus.classList.remove('status-online');
                elements.aiStatus.classList.add('status-offline');
                elements.aiStatusText.textContent = 'Offline';
                showToast('You are offline. AI chat limited.', 'warning');
            }
        }

        // Toggle scroll to top button
        function toggleScrollButton() {
            if (window.pageYOffset > 300) {
                elements.scrollTopBtn.classList.add('show');
            } else {
                elements.scrollTopBtn.classList.remove('show');
            }
        }

        // Scroll to top
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Setup AI responses with periodic messages
        function setupAIResponses() {
            // Occasionally show helpful tips
            const tips = [
                "Don't forget to review your notes tonight! 📓",
                "Start your homework early to avoid stress! ⏳",
                "Take short breaks every 25 minutes - it helps! ☕",
                "Ask for help if you don't understand something! 🙋",
                "Organize your workspace for better focus! 🧹",
                "Check your assignment due dates regularly! 📅",
                "Stay hydrated while studying - drink water! 💧",
                "Get a good night's sleep before tests! 😴"
            ];
            
            // Show a tip every 5-10 minutes
            setInterval(() => {
                if (Math.random() > 0.7 && state.aiOnline) {
                    const tip = getRandomItem(tips);
                    addChatMessage(tip, 'ai');
                }
            }, 300000 + Math.random() * 300000); // 5-10 minutes
        }

        // Generate PDF of homework
        function generatePDF() {
            showToast('Generating PDF...', 'info');
            
            // Create a simple HTML representation of the dashboard
            const pdfContent = `
                <html>
                <head>
                    <title>Homework Summary - ${state.user.name}</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 800px; margin: 0 auto; padding: 20px; }
                        .header { text-align: center; border-bottom: 2px solid #0d6efd; padding-bottom: 10px; margin-bottom: 20px; }
                        .title { color: #0d6efd; margin: 0; }
                        .student-info { margin: 10px 0; font-size: 14px; }
                        .section { margin: 20px 0; }
                        .section-title { color: #0d6efd; border-bottom: 1px solid #ddd; padding-bottom: 5px; margin-bottom: 15px; }
                        .homework-item { background: #f8f9fa; margin: 10px 0; padding: 15px; border-radius: 5px; border-left: 4px solid #0d6efd; }
                        .homework-subject { font-weight: bold; margin-bottom: 5px; }
                        .homework-desc { margin-bottom: 5px; }
                        .homework-due { font-size: 12px; color: #6c757d; }
                        .footer { text-align: center; margin-top: 30px; font-size: 12px; color: #6c757d; border-top: 1px solid #ddd; padding-top: 10px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1 class="title">🏫 School Web Dashboard</h1>
                        <div class="student-info">
                            <strong>Student:</strong> ${state.user.name} | 
                            <strong>Class:</strong> ${state.user.cls} | 
                            <strong>Date:</strong> ${new Date().toLocaleDateString()}
                        </div>
                    </div>
                    
                    <div class="section">
                        <h2 class="section-title">📚 Today's Homework</h2>
                        ${state.homework.map(hw => `
                            <div class="homework-item">
                                <div class="homework-subject">${hw.emoji} ${hw.subject}</div>
                                <div class="homework-desc">${hw.description}</div>
                                <div class="homework-due">Due: ${hw.due}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="section">
                        <h2 class="section-title">💬 AI Assistant Tips</h2>
                        <p>Remember to:</p>
                        <ul>
                            <li>Review your notes regularly</li>
                            <li>Start assignments early</li>
                            <li>Take regular breaks</li>
                            <li>Ask for help when needed</li>
                            <li>Get enough sleep</li>
                        </ul>
                    </div>
                    
                    <div class="footer">
                        Generated by School Web Dashboard • ${new Date().toLocaleString()}
                    </div>
                </body>
                </html>
            `;
            
            // Create blob and show in PDF viewer
            const blob = new Blob([pdfContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            elements.pdfEmbed.src = url;
            elements.pdfContainer.classList.add('active');
            
            showToast('PDF generated successfully! 📄', 'success');
        }

        // Request notification permission
        function requestNotificationPermission() {
            if (!('Notification' in window)) {
                showToast('This browser does not support notifications', 'danger');
                return;
            }
            
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    state.notificationPermission = true;
                    showToast('Notifications enabled! 🔔', 'success');
                } else {
                    showToast('Notifications denied', 'warning');
                }
            });
        }

        // Send notification
        function sendNotification() {
            if (!state.notificationPermission) {
                requestNotificationPermission();
                return;
            }
            
            if (Notification.permission === 'granted') {
                const homeworkCount = state.homework.length;
                const notification = new Notification('Homework Reminder', {
                    body: `You have ${homeworkCount} assignments due soon. Stay on track! 📚`,
                    icon: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64"><circle cx="32" cy="32" r="30" fill="%230d6efd"/><path d="M20 24h24v8H20zm0 12h24v8H20z" fill="white"/></svg>',
                    tag: 'homework-reminder'
                });
                
                notification.onclick = () => {
                    window.focus();
                    notification.close();
                };
                
                showToast('Notification sent! 🔔', 'success');
            } else {
                requestNotificationPermission();
            }
        }

        // Show notification permission prompt
        function showNotificationPrompt() {
            // Show after 10 seconds if permission not granted
            setTimeout(() => {
                if (!state.notificationPermission && Notification.permission !== 'denied') {
                    elements.notifPermission.style.display = 'block';
                }
            }, 10000);
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            elements.toast.textContent = message;
            elements.toast.className = `toast ${type}`;
            elements.toast.classList.add('show');
            
            setTimeout(() => {
                elements.toast.classList.remove('show');
            }, 3000);
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
