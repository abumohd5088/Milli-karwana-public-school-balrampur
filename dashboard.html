<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Dashboard | School Web #1</title>
    <style>
        :root{
            --primary:#0d6efd;
            --secondary:#6c757d;
            --light:#f8f9fa;
            --dark:#212529;
            --accent:#ffc107;
            --bg:#ffffff;
            --card:#f1f3f5;
        }
        body.dark{
            --bg:#121212;
            --card:#1e1e1e;
            --light:#212529;
            --dark:#f8f9fa;
        }
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
        body{background:var(--bg);color:var(--dark);transition:.3s;}
        .navbar{display:flex;justify-content:space-between;align-items:center;background:var(--primary);color:#fff;padding:12px 20px;font-weight:600;}
        .toggle-mode{background:none;border:none;color:#fff;font-size:1.2em;cursor:pointer;}
        .container{padding:15px;}
        .card{background:var(--card);border-radius:12px;padding:15px;margin-bottom:15px;box-shadow:0 2px 6px rgba(0,0,0,.1);}
        h2{margin-bottom:10px;font-size:1.2em;}
        .btn{background:var(--primary);color:#fff;border:none;padding:10px 15px;border-radius:8px;font-weight:600;width:100%;cursor:pointer;margin-top:8px;}
        .btn:hover{background:#084298;}
        .hw-list li{margin:8px 0;}
        .chat-box{height:200px;overflow-y:auto;border:1px solid #ccc;border-radius:8px;padding:8px;background:#fff;color:#000;margin-bottom:8px;}
        .chat-input{display:flex;gap:5px;}
        .chat-input input{flex:1;padding:8px;border:1px solid #ccc;border-radius:8px;}
        .chat-input button{padding:8px 12px;background:var(--accent);border:none;border-radius:8px;font-weight:bold;cursor:pointer;}
        footer{text-align:center;padding:15px;background:var(--light);color:var(--secondary);font-size:.8em;margin-top:30px;}
        @media(max-width:600px){.navbar{font-size:1em;}.card{padding:12px;}}
    </style>
</head>
<body>
    <nav class="navbar">
        <span>üè´ Dashboard - Class <span id="dispClass"></span></span>
        <button class="toggle-mode" onclick="toggleDark()">üåô</button>
    </nav>

    <div class="container">
        <!-- Welcome -->
        <div class="card">
            <h2>Hi, <span id="dispName"></span> üëã</h2>
            <button class="btn" onclick="logout()">Logout</button>
        </div>

        <!-- Homework Section -->
        <div class="card">
            <h2>üìö Homework (Class <span id="hwClass"></span>)</h2>
            <ul class="hw-list" id="hwList">
                <li>Loading...</li>
            </ul>
            <button class="btn" onclick="addHW()">Add New Homework</button>
        </div>

        <!-- AI Chat -->
        <div class="card">
            <h2>ü§ñ AI Homework Helper</h2>
            <div class="chat-box" id="chatBox"></div>
            <div class="chat-input">
                <input id="chatIn" placeholder="Ask homework question..." />
                <button onclick="askAI()">Send</button>
            </div>
        </div>

        <!-- Quick Links -->
        <div class="card">
            <h2>üîó Quick Links</h2>
            <button class="btn" onclick="location.href='admin.html'">Admin Panel</button>
            <button class="btn" onclick="window.open('https://wa.me/?text=Check%20my%20homework','_blank')">Share on WhatsApp</button>
        </div>
    </div>

    <footer>¬© 2025 School Web - Built by #1</footer>

    <script>
        // Dark mode
        function toggleDark(){
            document.body.classList.toggle('dark');
            localStorage.setItem('dark',document.body.classList.contains('dark'));
        }
        if(localStorage.getItem('dark')==='true'){document.body.classList.add('dark');}

        // Auth check
        if(!localStorage.getItem('studentName')) location.href='index.html';

        // Display name & class
        const cls = localStorage.getItem('studentClass');
        document.getElementById('dispName').innerText = localStorage.getItem('studentName');
        document.getElementById('dispClass').innerText = cls;
        document.getElementById('hwClass').innerText = cls;

        // Dummy homework (replace with dynamic later)
        const hw = [
            'Maths: Ex 3.1 Q1-5',
            'Science: Draw diagram of cell',
            'English: Write essay on ‚ÄúMy School‚Äù'
        ];
        document.getElementById('hwList').innerHTML = hw.map(h=>`<li>${h}</li>`).join('');

        // Logout
        function logout(){
            localStorage.clear();
            location.href='index.html';
        }

        // AI Chat
        async function askAI(){
            const msg = document.getElementById('chatIn').value;
            if(!msg) return;
            const box = document.getElementById('chatBox');
            box.innerHTML += `<div><b>You:</b> ${msg}</div>`;
            document.getElementById('chatIn').value='';

            const res = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyCdzFBQ1KVgBfmmjSgHJJwcuLbqne9VjUs",{
                method:"POST",
                headers:{"Content-Type":"application/json"},
                body:JSON.stringify({contents:[{parts:[{text:`Class ${cls} student asks: ${msg}`}]}]})
            });
            const data = await res.json();
            const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "No reply";
            box.innerHTML += `<div><b>AI:</b> ${reply}</div>`;
            box.scrollTop = box.scrollHeight;
        }

        // Placeholder for add HW
        function addHW(){
            const task = prompt("Enter new homework:");
            if(task){
                const li=document.createElement('li');
                li.innerText=task;
                document.getElementById('hwList').appendChild(li);
            }
        }
    </script>
</body>
</html>
