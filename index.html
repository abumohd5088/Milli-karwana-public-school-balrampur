<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Milli karwaan public School - Login</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      margin: 0;
    }
    .tab {
      @apply px-6 py-3 font-medium text-center cursor-pointer transition;
    }
    .tab.active {
      @apply text-blue-600 border-b-2 border-blue-600;
    }
    .form-container {
      @apply mt-6 p-5 bg-white rounded-lg shadow-md transition-all duration-300;
    }
    .btn {
      @apply bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-5 rounded transition;
    }
    .input-group {
      @apply mb-4;
    }
    .input-group label {
      @apply block text-sm font-medium text-gray-700 mb-1;
    }
    .input-group input, .input-group select {
      @apply w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500;
    }
    .error {
      @apply text-red-500 text-sm mt-2;
    }
    .hidden {
      display: none;
    }
    .loader {
      border: 2px solid #f3f3f3; border-top: 2px solid #3498db; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; margin-right: 8px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="text-gray-800">

  <div class="container max-w-4xl mx-auto p-4 pt-10">
    <h1 class="text-3xl font-bold text-center text-blue-700 mb-2">SchoolConnect</h1>
    <p class="text-center text-gray-600 mb-8">One Platform for Students, Parents & Teachers</p>

    <!-- Google Sign In Button -->
    <div class="flex justify-center mb-6">
      <div id="g_id_onload"
           data-client_id="529549341206-st52n2e42jkobemc9kenva0jf8ccmhf2.apps.googleusercontent.com"
           data-context="signin"
           data-ux_mode="popup"
           data-callback="handleCredentialResponse"
           data-auto_select="false"
           data-itp_support="true">
      </div>
      <div class="g_id_signin"
           data-type="standard"
           data-shape="rectangular"
           data-theme="outline"
           data-text="signin_with"
           data-size="large"
           data-logo_alignment="left">
      </div>
    </div>

    <!-- Tabs -->
    <div class="flex border-b border-gray-300 mb-6">
      <div class="tab active" data-tab="student">Student</div>
      <div class="tab" data-tab="parent">Parent</div>
      <div class="tab" data-tab="teacher">Teacher</div>
    </div>

    <!-- User Info After Google Login -->
    <div id="user-info" class="hidden mb-4 p-4 bg-green-50 border border-green-200 rounded text-green-800 text-sm">
      Logged in as <strong id="user-email">â€”</strong>
    </div>

    <!-- Forms Container -->
    <div id="form-container">
      <!-- Student Form (Default) -->
      <div id="student-form" class="form-container">
        <h3 class="text-xl font-semibold mb-4">Student Details</h3>
        <form id="studentForm">
          <div class="input-group">
            <label>Full Name</label>
            <input type="text" name="name" required />
          </div>
          <div class="input-group">
            <label>Parent's Name</label>
            <input type="text" name="parentName" required />
          </div>
          <div class="input-group">
            <label>Class</label>
            <select name="class" required>
              <option value="">Select Class</option>
              <script>
                for (let i = 1; i <= 8; i++) document.write(`<option value="${i}">Class ${i}</option>`);
              </script>
            </select>
          </div>
          <button type="submit" class="btn">Continue to Dashboard</button>
        </form>
      </div>

      <!-- Parent Form -->
      <div id="parent-form" class="form-container hidden">
        <h3 class="text-xl font-semibold mb-4">Parent Details</h3>
        <form id="parentForm">
          <div class="input-group">
            <label>Your Name</label>
            <input type="text" name="parentName" required />
          </div>
          <div class="input-group">
            <label>Child's Name</label>
            <input type="text" name="childName" required />
          </div>
          <div class="input-group">
            <label>Class</label>
            <select name="class" required>
              <option value="">Select Class</option>
              <script>
                for (let i = 1; i <= 8; i++) document.write(`<option value="${i}">Class ${i}</option>`);
              </script>
            </select>
          </div>
          <button type="submit" class="btn">Verify & Enter</button>
        </form>
        <p id="parent-error" class="error hidden">Your child is not registered.</p>
      </div>

      <!-- Teacher Form -->
      <div id="teacher-form" class="form-container hidden">
        <h3 class="text-xl font-semibold mb-4">Teacher Login</h3>
        <form id="teacherForm">
          <div class="input-group">
            <label>Teacher Name</label>
            <input type="text" name="teacherName" value="Abutalha" readonly class="bg-gray-100" />
          </div>
          <div class="input-group">
            <label>Password</label>
            <input type="password" name="password" required placeholder="Enter password" />
          </div>
          <button type="submit" class="btn">Login as Teacher</button>
        </form>
        <p id="teacher-error" class="error hidden">Invalid credentials.</p>
      </div>
    </div>
  </div>

  <script>
    // Tab Switching
    const tabs = document.querySelectorAll('.tab');
    const forms = {
      student: document.getElementById('student-form'),
      parent: document.getElementById('parent-form'),
      teacher: document.getElementById('teacher-form')
    };

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        Object.keys(forms).forEach(key => forms[key].classList.add('hidden'));
        const role = tab.getAttribute('data-tab');
        forms[role].classList.remove('hidden');
      });
    });

    // Google Sign-In Response
    let googleUserEmail = null;

    function handleCredentialResponse(response) {
      const credential = response.credential;
      const decoded = parseJwt(credential);
      googleUserEmail = decoded.email;

      document.getElementById('user-email').textContent = decoded.email;
      document.getElementById('user-info').classList.remove('hidden');

      // Show the correct form based on active tab
      const activeTab = document.querySelector('.tab.active').getAttribute('data-tab');
      forms[activeTab].classList.remove('hidden');
    }

    function parseJwt(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    // Dummy Data for Validation
    const dummyStudents = [
      { name: "Ali Raza", parent: "Sana Raza", class: 5 },
      { name: "Zainab Khan", parent: "Imran Khan", class: 7 },
      { name: "Umar Farooq", parent: "Nadia Farooq", class: 5 },
    ];

    const dummyParents = [
      { parent: "Sana Raza", child: "Ali Raza", class: 5 },
      { parent: "Imran Khan", child: "Zainab Khan", class: 7 },
      { parent: "Nadia Farooq", child: "Umar Farooq", class: 5 },
    ];

    // Student Form Submit
    document.getElementById('studentForm').onsubmit = function (e) {
      e.preventDefault();
      if (googleUserEmail) {
        const data = new FormData(this);
        const studentData = {
          role: 'student',
          name: data.get('name'),
          parentName: data.get('parentName'),
          class: data.get('class'),
          email: googleUserEmail
        };
        localStorage.setItem('currentUser', JSON.stringify(studentData));
        window.location.href = 'dashboard.html';
      }
    };

    // Parent Form Submit
    document.getElementById('parentForm').onsubmit = function (e) {
      e.preventDefault();
      const data = new FormData(this);
      const parentName = data.get('parentName');
      const childName = data.get('childName');
      const classNum = parseInt(data.get('class'));

      const match = dummyParents.some(p =>
        (p.parent === parentName) +
        (p.child === childName) +
        (p.class === classNum) >= 2
      );

      if (match) {
        const child = dummyStudents.find(s => s.name === childName && s.class === classNum);
        if (child) {
          const parentData = {
            role: 'parent',
            parentName,
            childName,
            class: classNum,
            email: googleUserEmail,
            childDetails: child
          };
          localStorage.setItem('currentUser', JSON.stringify(parentData));
          window.location.href = 'parent.html';
        }
      } else {
        document.getElementById('parent-error').classList.remove('hidden');
        setTimeout(() => document.getElementById('parent-error').classList.add('hidden'), 3000);
      }
    };

    // Teacher Form Submit
    document.getElementById('teacherForm').onsubmit = function (e) {
      e.preventDefault();
      const data = new FormData(this);
      const name = data.get('teacherName');
      const pass = data.get('password');

      if (name === 'Abutalha' && pass === 'Abutalha') {
        const teacherData = {
          role: 'teacher',
          name: 'Abutalha',
          email: googleUserEmail
        };
        localStorage.setItem('currentUser', JSON.stringify(teacherData));
        window.location.href = 'teacher.html';
      } else {
        document.getElementById('teacher-error').classList.remove('hidden');
        setTimeout(() => document.getElementById('teacher-error').classList.add('hidden'), 3000);
      }
    };

    // Auto-show active form after Google login
    window.onload = () => {
      // Default to student
      forms.student.classList.remove('hidden');
    };
  </script>

</body>
</html>
