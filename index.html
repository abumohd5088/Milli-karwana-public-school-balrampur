<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Milli Karwaan Public School | Login</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Arial;}
    body{
      min-height:100vh;
      display:flex;align-items:center;justify-content:center;
      background:linear-gradient(135deg,#007bff,#6610f2,#6f42c1);
      background-size:300% 300%;animation:bgmove 15s infinite alternate;
      color:#fff;
    }
    @keyframes bgmove{
      from{background-position:0 0;}
      to{background-position:100% 100%;}
    }
    .card{
      background:rgba(255,255,255,0.1);
      backdrop-filter:blur(20px);
      border-radius:25px;
      box-shadow:0 10px 30px rgba(0,0,0,0.3);
      padding:30px 20px;
      width:95%;max-width:400px;
      text-align:center;
      animation:fadeIn 1.2s ease;
    }
    @keyframes fadeIn{
      from{opacity:0;transform:translateY(50px);}
      to{opacity:1;transform:translateY(0);}
    }
    img{width:90px;margin-bottom:15px;}
    h1{font-size:1.5rem;margin-bottom:5px;}
    p.sub{opacity:0.8;margin-bottom:20px;}
    .g_id_signin{margin:10px auto;}
    input,button{
      width:100%;padding:12px;margin-top:10px;
      border:none;border-radius:12px;font-size:1rem;
    }
    input{background:#fff;color:#333;}
    button{
      background:#ffc107;color:#000;font-weight:bold;
      cursor:pointer;transition:0.3s;
    }
    button:hover{background:#ffcd39;transform:scale(1.02);}
    #chat{
      margin-top:20px;text-align:left;
      background:rgba(0,0,0,0.3);
      padding:10px;border-radius:12px;
      height:160px;overflow-y:auto;font-size:0.9rem;
    }
    #chat p{margin:6px 0;}
    .me{color:#ffd966;}
    .ai{color:#0df5e3;}
  </style>
</head>
<body>
  <div class="card">
    <img src="https://i.postimg.cc/ryGx49TB/erasebg-transformed.png" alt="Logo">
    <h1>Milli Karwaan Public School</h1>
    <p class="sub">Balrampur, Uttar Pradesh</p>

    <!-- Google Login -->
    <div id="g_id_onload"
         data-client_id="529549341206-1fnunb0pn34k7bjqe9ot5mc1vplantfj.apps.googleusercontent.com"
         data-callback="handleLogin"></div>
    <div class="g_id_signin" data-type="standard"></div>

    <!-- Backup Normal Login -->
    <input type="text" id="studentName" placeholder="Enter your name">
    <input type="text" id="studentClass" placeholder="Enter your class">
    <button onclick="manualLogin()">Login</button>

    <!-- AI Chat Help -->
    <h3 style="margin-top:20px;">ü§ñ Login Help</h3>
    <div id="chat"><p class="ai">AI: Ask me about login / account üëá</p></div>
    <input type="text" id="userInput" placeholder="Type here...">
    <button onclick="sendMessage()">Ask AI</button>
  </div>

<script>
// Google login
function handleLogin(response){
  const data=JSON.parse(atob(response.credential.split('.')[1]));
  localStorage.setItem("mkps_student",JSON.stringify({
    name:data.name,email:data.email,picture:data.picture
  }));
  alert("Welcome "+data.name+" üéâ");
  window.location.href="dashboard.html";
}
// Manual login
function manualLogin(){
  let name=document.getElementById("studentName").value.trim();
  let cls=document.getElementById("studentClass").value.trim();
  if(!name||!cls){alert("Enter both name & class");return;}
  localStorage.setItem("mkps_student",JSON.stringify({name:name,class:cls}));
  window.location.href="dashboard.html";
}
// AI Chat
async function sendMessage(){
  let input=document.getElementById("userInput");
  let text=input.value.trim();if(!text)return;
  let chat=document.getElementById("chat");
  chat.innerHTML+=`<p class="me">üë§ You: ${text}</p>`;
  input.value="";
  try{
    let res=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=AIzaSyCqGS8gb5kh7Jr0pv8d84LxCLhgHU-O_VU",{
      method:"POST",headers:{"Content-Type":"application/json"},
      body:JSON.stringify({contents:[{parts:[{text:`Answer only about login or account issues: ${text}`}]}]})
    });
    let data=await res.json();
    let reply=data.candidates?.[0]?.content?.parts?.[0]?.text||"Sorry, I didn‚Äôt get that.";
    chat.innerHTML+=`<p class="ai">ü§ñ AI: ${reply}</p>`;
    chat.scrollTop=chat.scrollHeight;
  }catch(err){
    chat.innerHTML+=`<p class="ai">‚ö†Ô∏è Error: ${err.message}</p>`;
  }
}
</script>
</body>
</html>
