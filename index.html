<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Milli Karwaan Public School | Login</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
    body{
      min-height:100vh;display:flex;align-items:center;justify-content:center;
      background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
      color:#fff;
    }
    .card{
      background:rgba(255,255,255,0.08);backdrop-filter:blur(15px);
      padding:2rem;border-radius:20px;width:95%;max-width:400px;
      box-shadow:0 8px 30px rgba(0,0,0,0.4);animation:fadeIn 1s ease-in-out;
    }
    .logo{text-align:center;margin-bottom:1rem;}
    .logo img{width:80px;filter:drop-shadow(0 0 5px #fff);}
    h2{text-align:center;margin-bottom:1rem;font-weight:600;}
    label{font-size:0.9rem;margin-top:1rem;display:block;}
    input,select{
      width:100%;padding:0.7rem;margin-top:0.3rem;border:none;
      border-radius:10px;background:rgba(255,255,255,0.2);
      color:#fff;outline:none;
    }
    input::placeholder{color:#ddd;}
    button{
      margin-top:1.5rem;width:100%;padding:0.8rem;border:none;
      border-radius:10px;background:linear-gradient(135deg,#00c6ff,#0072ff);
      color:#fff;font-weight:600;cursor:pointer;transition:0.3s;
    }
    button:hover{opacity:0.85;}
    .google-btn{
      margin-top:1rem;width:100%;background:#fff;color:#444;
      font-weight:600;display:flex;align-items:center;justify-content:center;
      gap:10px;box-shadow:0 4px 10px rgba(0,0,0,0.2);
    }
    .google-btn img{width:20px;}
    .toggle{
      margin-top:1rem;text-align:center;cursor:pointer;font-size:0.85rem;
    }
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
  </style>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <div class="card">
    <div class="logo">
      <img src="https://i.postimg.cc/ryGx49TB/erasebg-transformed.png" alt="School Logo">
    </div>
    <h2>Welcome to MKPS Balrampur</h2>
    <form id="studentForm">
      <label>Student Name</label>
      <input type="text" id="studentName" placeholder="Enter your name" required>
      <label>Class</label>
      <select id="studentClass" required>
        <option value="">Select Class</option>
        <option value="1">Class 1</option>
        <option value="2">Class 2</option>
        <option value="3">Class 3</option>
        <option value="4">Class 4</option>
        <option value="5">Class 5</option>
        <option value="6">Class 6</option>
        <option value="7">Class 7</option>
        <option value="8">Class 8</option>
      </select>
      <label>Parent Name</label>
      <input type="text" id="parentName" placeholder="Enter parent name" required>
      <button type="submit">Login</button>
    </form>
    <div id="g_id_onload"
      data-client_id="529549341206-st52n2e42jkobemc9kenva0jf8ccmhf2.apps.googleusercontent.com"
      data-callback="handleGoogleResponse"
      data-auto_prompt="false">
    </div>
    <div class="g_id_signin google-btn" data-type="standard" data-shape="rect" data-theme="outline" data-text="signin_with" data-size="large"></div>
    <div class="toggle" onclick="toggleTheme()">ðŸŒ— Toggle Dark/Light</div>
  </div>

  <script>
    // Theme toggle
    function toggleTheme(){
      document.body.classList.toggle("light");
      if(document.body.classList.contains("light")){
        document.body.style.background="linear-gradient(135deg,#f5f7fa,#c3cfe2)";
        document.body.style.color="#000";
      }else{
        document.body.style.background="linear-gradient(135deg,#0f2027,#203a43,#2c5364)";
        document.body.style.color="#fff";
      }
    }

    // Manual form login
    document.getElementById("studentForm").addEventListener("submit",function(e){
      e.preventDefault();
      let student={
        name:document.getElementById("studentName").value.trim(),
        class:document.getElementById("studentClass").value,
        parent:document.getElementById("parentName").value.trim()
      };
      if(!student.name||!student.class||!student.parent){alert("Please fill all fields");return;}
      localStorage.setItem("mkps_student",JSON.stringify(student));
      window.location.href="dashboard.html";
    });

    // Google login response
    function handleGoogleResponse(response){
      try{
        const data=jwt_decode(response.credential);
        let student={
          name:data.name,
          email:data.email,
          class:"",parent:"GoogleLogin"
        };
        localStorage.setItem("mkps_student",JSON.stringify(student));
        window.location.href="dashboard.html";
      }catch(err){
        alert("Google login failed: "+err.message);
      }
    }

    // JWT decode
    function jwt_decode(token){
      let base64Url=token.split('.')[1];
      let base64=base64Url.replace(/-/g,'+').replace(/_/g,'/');
      let jsonPayload=decodeURIComponent(atob(base64).split('').map(c=>{
        return'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    // If already logged in â†’ go to dashboard
    if(localStorage.getItem("mkps_student")){
      window.location.href="dashboard.html";
    }
  </script>
</body>
</html>
