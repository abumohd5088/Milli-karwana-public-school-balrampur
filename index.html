<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>MKPS Balrampur ‚Äì Login</title>
  <meta name="theme-color" content="#ffffff" />
  <link rel="manifest" href="manifest.json" />
  <style>
    :root {
      --primary:#0a558c;
      --primary-light:#0f73bf;
      --bg:#ffffff;
      --text:#111;
      --card:#f7f9fc;
      --border:#e1e5eb;
      --error:#d93025;
      --radius:12px;
      --shadow:0 4px 12px rgba(0,0,0,.08);
      font-size:16px;
    }
    [data-theme="dark"]{
      --bg:#121212;
      --text:#eee;
      --card:#1e1e1e;
      --border:#333;
      --shadow:0 4px 12px rgba(0,0,0,.4);
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',system-ui,Arial}
    body{background:var(--bg);color:var(--text);display:flex;flex-direction:column;min-height:100vh}
    header{position:sticky;top:0;z-index:30;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:space-between;padding:.5rem .75rem;box-shadow:0 2px 6px rgba(0,0,0,.15)}
    header img{height:40px;border-radius:50%}
    header h1{font-size:1.1rem;font-weight:600;margin-left:.5rem}
    .top-actions{display:flex;gap:.5rem;align-items:center}
    .top-actions button{background:none;border:none;color:#fff;font-size:1.4rem;cursor:pointer}
    main{flex:1;padding:1rem}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:1.25rem 1rem;box-shadow:var(--shadow);max-width:420px;margin:0 auto 1.5rem}
    .tabs{display:flex;border-bottom:1px solid var(--border);margin-bottom:1rem}
    .tabs button{flex:1;border:none;background:none;padding:.75rem;font-weight:600;cursor:pointer;color:var(--text)}
    .tabs button.active{border-bottom:2px solid var(--primary);color:var(--primary)}
    form{display:flex;flex-direction:column;gap:.75rem}
    label{font-size:.9rem}
    input,select{width:100%;padding:.6rem;border:1px solid var(--border);border-radius:6px;background:var(--bg);color:var(--text);transition:border .2s}
    input:focus,select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(10,85,140,.15)}
    button[type="submit"]{background:var(--primary);color:#fff;font-weight:600;padding:.7rem;border:none;border-radius:6px;cursor:pointer;margin-top:.5rem}
    button[type="submit"]:hover{background:var(--primary-light)}
    .error{color:var(--error);font-size:.85rem}
    .hidden{display:none}
    .gsi-btn{background:#fff;color:#444;border:1px solid #dadce0;border-radius:4px;padding:.45rem 1rem;font-weight:500;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:.5rem}
    .gsi-btn img{width:18px;height:18px}
    .divider{margin:1.2rem 0;text-align:center;font-size:.85rem;color:var(--text);opacity:.7}
    #threeDotMenu{position:absolute;top:48px;right:8px;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:.3rem 0;z-index:40;display:none}
    #threeDotMenu button{display:block;width:100%;text-align:left;background:none;border:none;padding:.6rem 1rem;cursor:pointer;font-size:.9rem;color:var(--text)}
    #threeDotMenu button:hover{background:var(--primary);color:#fff}
    .toast{position:fixed;bottom:1rem;left:50%;transform:translateX(-50%);background:#323232;color:#fff;padding:.7rem 1rem;border-radius:6px;font-size:.9rem;z-index:100;opacity:0;transition:opacity .3s}
    .toast.show{opacity:1}
    @media(prefers-color-scheme:dark){:root:not([data-theme]){--bg:#121212;--text:#eee;--card:#1e1e1e;--border:#333;--shadow:0 4px 12px rgba(0,0,0,.4)}}
  </style>
</head>
<body>
  <header>
    <div style="display:flex;align-items:center">
      <img src="https://i.postimg.cc/ryGx49TB/erasebg-transformed.png" alt="Logo" />
      <h1>Milli Karwaan Public School</h1>
    </div>
    <div class="top-actions">
      <button id="themeToggle" aria-label="Toggle theme">üåô</button>
      <button id="langToggle" aria-label="Toggle language">üåê</button>
      <button id="bell" aria-label="Notifications">üîî</button>
      <button id="threeDotBtn" aria-label="More">‚ãÆ</button>
      <div id="threeDotMenu">
        <button data-lang-key="profile">Profile</button>
        <button data-lang-key="logout">Logout</button>
      </div>
    </div>
  </header>

  <main>
    <section class="card">
      <h2 data-lang-key="login">Login</h2>

      <!-- Google Sign-In -->
      <button class="gsi-btn" id="googleBtn">
        <img alt="Google" src="https://developers.google.com/identity/images/g-logo.png" />
        <span data-lang-key="signInGoogle">Sign in with Google</span>
      </button>

      <div class="divider" data-lang-key="or">OR</div>

      <!-- Tabs -->
      <div class="tabs" id="tabs">
        <button class="tab active" data-role="student" data-lang-key="student">Student</button>
        <button class="tab" data-role="parent" data-lang-key="parent">Parent</button>
        <button class="tab" data-role="teacher" data-lang-key="teacher">Teacher</button>
      </div>

      <!-- Student Form -->
      <form id="studentForm">
        <label data-lang-key="name">Name</label>
        <input type="text" name="name" required />
        <label data-lang-key="parentName">Parent Name</label>
        <input type="text" name="parentName" required />
        <label data-lang-key="class">Class</label>
        <select name="cls" required>
          <option disabled selected value="">Select</option>
          <option>Nursery</option><option>1</option><option>2</option><option>3</option><option>4</option>
          <option>5</option><option>6</option><option>7</option><option>8</option>
        </select>
        <button type="submit" data-lang-key="loginBtnStudent">Login as Student</button>
      </form>

      <!-- Parent Form -->
      <form id="parentForm" class="hidden">
        <label data-lang-key="yourName">Your Name</label>
        <input type="text" name="parentName" required />
        <label data-lang-key="childName">Child Name</label>
        <input type="text" name="childName" required />
        <label data-lang-key="class">Class</label>
        <select name="cls" required>
          <option disabled selected value="">Select</option>
          <option>Nursery</option><option>1</option><option>2</option><option>3</option><option>4</option>
          <option>5</option><option>6</option><option>7</option><option>8</option>
        </select>
        <button type="submit" data-lang-key="loginBtnParent">Login as Parent</button>
        <p class="error hidden" id="parentError" data-lang-key="parentError">Your child is not registered</p>
      </form>

      <!-- Teacher Form -->
      <form id="teacherForm" class="hidden">
        <label data-lang-key="name">Name</label>
        <input type="text" name="name" required />
        <label data-lang-key="password">Password</label>
        <input type="password" name="password" required />
        <button type="submit" data-lang-key="loginBtnTeacher">Login as Teacher</button>
        <p class="error hidden" id="teacherError" data-lang-key="teacherError">Invalid password</p>
      </form>
    </section>
  </main>

  <div id="toast" class="toast"></div>

  <script>
    /* ====== Utilities ====== */
    const StorageUtil = {
      prefix: 'mkps_',
      get(k){return JSON.parse(localStorage.getItem(this.prefix+k)||'null')},
      set(k,v){localStorage.setItem(this.prefix+k,JSON.stringify(v))},
      remove(k){localStorage.removeItem(this.prefix+k)}
    };
    const i18n = {
      dict: {
        en:{
          login:'Login', signInGoogle:'Sign in with Google', or:'OR',
          student:'Student', parent:'Parent', teacher:'Teacher',
          name:'Name', parentName:'Parent Name', class:'Class',
          yourName:'Your Name', childName:'Child Name',
          loginBtnStudent:'Login as Student', loginBtnParent:'Login as Parent', loginBtnTeacher:'Login as Teacher',
          password:'Password', profile:'Profile', logout:'Logout',
          parentError:'Your child is not registered', teacherError:'Invalid password',
          welcome:'Welcome', missingRole:'Please select your role to continue'
        },
        hi:{
          login:'‡§≤‡•â‡§ó‡§ø‡§®', signInGoogle:'Google ‡§∏‡•á ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç', or:'‡§Ø‡§æ',
          student:'‡§õ‡§æ‡§§‡•ç‡§∞', parent:'‡§Æ‡§æ‡§§‡§æ-‡§™‡§ø‡§§‡§æ', teacher:'‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï',
          name:'‡§®‡§æ‡§Æ', parentName:'‡§Æ‡§æ‡§§‡§æ-‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ', class:'‡§ï‡§ï‡•ç‡§∑‡§æ',
          yourName:'‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ', childName:'‡§¨‡§ö‡•ç‡§ö‡•á ‡§ï‡§æ ‡§®‡§æ‡§Æ',
          loginBtnStudent:'‡§õ‡§æ‡§§‡•ç‡§∞ ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç',
          loginBtnParent:'‡§Æ‡§æ‡§§‡§æ-‡§™‡§ø‡§§‡§æ ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç',
          loginBtnTeacher:'‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç',
          password:'‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°', profile:'‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤', logout:'‡§≤‡•â‡§ó‡§Ü‡§â‡§ü',
          parentError:'‡§Ü‡§™‡§ï‡§æ ‡§¨‡§ö‡•ç‡§ö‡§æ ‡§™‡§Ç‡§ú‡•Ä‡§ï‡•É‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à', teacherError:'‡§ó‡§≤‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°',
          welcome:'‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à', missingRole:'‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡•Ä ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç'
        }
      },
      lang:'en',
      t(k){return this.dict[this.lang][k]||k},
      setLang(l){this.lang=l;StorageUtil.set('lang',l);this.scan()}
    };
    i18n.scan = ()=>document.querySelectorAll('[data-lang-key]').forEach(el=>el.textContent=i18n.t(el.dataset.langKey));
    i18n.setLang(StorageUtil.get('lang')||'en');

    /* ====== Theme ====== */
    const themeToggle = document.getElementById('themeToggle');
    const applyTheme=()=>{const t=StorageUtil.get('theme')||(window.matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light');
    document.documentElement.setAttribute('data-theme',t);themeToggle.textContent=t==='dark'?'‚òÄÔ∏è':'üåô';}
    applyTheme();
    themeToggle.onclick=()=>{
      const newTheme = document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark';
      StorageUtil.set('theme',newTheme);applyTheme();
    };

    /* ====== Toast ====== */
    const toast = (msg,type='info')=>{
      const el=document.getElementById('toast');
      el.textContent=msg;el.classList.add('show');
      setTimeout(()=>el.classList.remove('show'),3000);
    };

    /* ====== Tabs ====== */
    const tabs=document.querySelectorAll('.tab');
    const forms={student:studentForm,parent:parentForm,teacher:teacherForm};
    tabs.forEach(t=>t.onclick=()=>{
      tabs.forEach(x=>x.classList.remove('active'));
      t.classList.add('active');
      Object.values(forms).forEach(f=>f.classList.add('hidden'));
      forms[t.dataset.role].classList.remove('hidden');
    });

    /* ====== Three-dot menu ====== */
    const threeDotBtn=document.getElementById('threeDotBtn');
    const threeDotMenu=document.getElementById('threeDotMenu');
    threeDotBtn.onclick=e=>{
      e.stopPropagation();
      threeDotMenu.style.display=threeDotMenu.style.display==='block'?'none':'block';
    };
    document.addEventListener('click',()=>threeDotMenu.style.display='none');
    threeDotMenu.querySelector('[data-lang-key="logout"]').onclick=()=>{
      StorageUtil.remove('currentUser');
      location.reload();
    };

    /* ====== Manual Login ====== */
    const handle = (form,role)=>{
      form.addEventListener('submit',e=>{
        e.preventDefault();
        const fd=new FormData(form);
        const data=Object.fromEntries(fd.entries());
        if(role==='student'){
          const user={...data,role,email:'',provider:'manual'};
          StorageUtil.set('currentUser',user);
          StorageUtil.set('students',(StorageUtil.get('students')||[]).concat(user));
          location.href='dashboard.html';
        }
        if(role==='parent'){
          const students=StorageUtil.get('students')||[];
          const matched=students.filter(s=>s.cls===data.cls && (s.name===data.childName || s.parentName===data.parentName));
          if(students.length===0){toast(i18n.t('parentError'));return;}
          if(matched.length===0){parentError.classList.remove('hidden');return;}
          const user={parentName:data.parentName,childName:data.childName,cls:data.cls,role:'parent',email:'',provider:'manual'};
          StorageUtil.set('currentUser',user);
          location.href='parent.html';
        }
        if(role==='teacher'){
          if(data.password!=='Abutalha'){teacherError.classList.remove('hidden');return;}
          const user={name:data.name,role:'teacher',email:'',provider:'manual'};
          StorageUtil.set('currentUser',user);
          location.href='teacher.html';
        }
      });
    };
    handle(studentForm,'student');
    handle(parentForm,'parent');
    handle(teacherForm,'teacher');

    /* ====== Google Sign-In ====== */
    const gsiScript=document.createElement('script');
    gsiScript.src='https://accounts.google.com/gsi/client';
    document.head.appendChild(gsiScript);
    gsiScript.onload=()=>{
      google.accounts.id.initialize({
        client_id:'529549341206-st52n2e42jkobemc9kenva0jf8ccmhf2.apps.googleusercontent.com',
        callback:(response)=>{
          const {payload}=JSON.parse(atob(response.credential));
          const {name,email}=payload;
          const role=prompt(`${i18n.t('welcome')} ${name}. ${i18n.t('missingRole')} (student/parent/teacher)`);
          if(!['student','parent','teacher'].includes(role)){toast('Invalid role');return;}
          let extra={};
          if(role==='student'){
            extra.parentName=prompt('Parent Name');
            extra.cls=prompt('Class (Nursery-8)');
          }
          if(role==='parent'){
            extra.childName=prompt('Child Name');
            extra.cls=prompt('Child Class');
          }
          const user={name,email,role,provider:'google',...extra};
          StorageUtil.set('currentUser',user);
          if(role==='student')StorageUtil.set('students',(StorageUtil.get('students')||[]).concat(user));
          location.href=role==='student'?'dashboard.html':role==='parent'?'parent.html':'teacher.html';
        }
      });
      google.accounts.id.renderButton(document.getElementById('googleBtn'),{theme:'outline',size:'large'});
    };
  </script>
</body>
</html>
