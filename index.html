<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>MKPS Balrampur – Welcome</title>

  <!-- Google Font & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    :root{
      --primary:#0d47a1;
      --primary-light:#1976d2;
      --accent:#ff6f00;
      --white:#ffffff;
      --bg:#f5f7fa;
      --text:#212121;
      --muted:#757575;
      --danger:#d32f2f;
    }
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}
    body{background:linear-gradient(135deg,var(--primary-light),var(--accent));min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .card{background:var(--white);border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,.15);width:100%;max-width:420px;padding:40px 30px;text-align:center}
    .brand{display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:30px}
    .brand i{font-size:36px;color:var(--primary)}
    .brand h1{font-size:24px;font-weight:700;color:var(--text)}
    .role-tabs{display:flex;border-radius:12px;background:#eef2f7;margin-bottom:25px}
    .role-tabs button{flex:1;padding:12px;border:none;background:transparent;border-radius:12px;font-weight:600;color:var(--muted);cursor:pointer;transition:.3s}
    .role-tabs button.active{background:var(--primary);color:var(--white)}
    .section{display:none;animation:fadeIn .4s}
    .section.active{display:block}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .input-group{position:relative;margin-bottom:20px}
    .input-group label{display:block;text-align:left;font-size:.9rem;color:var(--text);margin-bottom:6px}
    .input-group input,.input-group select{width:100%;padding:12px 14px;border:1px solid #e0e0e0;border-radius:10px;font-size:.95rem;transition:.3s}
    .input-group input:focus,.input-group select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(25,118,210,.2)}
    .btn-primary{width:100%;padding:14px;border:none;border-radius:10px;background:var(--primary);color:var(--white);font-weight:600;font-size:1rem;cursor:pointer;transition:.3s}
    .btn-primary:hover{background:var(--primary-light)}
    .btn-outline{background:transparent;border:1px solid var(--primary);color:var(--primary)}
    .btn-outline:hover{background:var(--primary);color:#fff}
    .error{color:var(--danger);font-size:.85rem;margin-top:10px;text-align:center}
    .hidden{display:none}
    .g-signin2{margin:15px auto}
  </style>
</head>
<body>

  <div class="card">
    <!-- Brand -->
    <div class="brand">
      <i class="fas fa-graduation-cap"></i>
      <h1>Mili Karwaan Public School</h1>
    </div>

    <!-- Role Tabs -->
    <div class="role-tabs">
      <button class="tab active" data-role="student">Student</button>
      <button class="tab" data-role="parent">Parent</button>
      <button class="tab" data-role="teacher">Teacher</button>
    </div>

    <!-- Student Section -->
    <div id="student" class="section active">
      <form id="studentForm">
        <div class="input-group">
          <label>Student Name</label>
          <input type="text" name="name" placeholder="Enter full name" required />
        </div>
        <div class="input-group">
          <label>Parent / Guardian Name</label>
          <input type="text" name="parentName" placeholder="Parent / Guardian" required />
        </div>
        <div class="input-group">
          <label>Class</label>
          <select name="class" required>
            <option value="" disabled selected>Select Class</option>
            <option>Nursery</option><option>LKG</option><option>UKG</option>
            <option>1</option><option>2</option><option>3</option><option>4</option>
            <option>5</option><option>6</option><option>7</option><option>8</option>
          </select>
        </div>
        <div class="input-group">
          <label>Roll Number</label>
          <input type="text" name="rollNo" placeholder="e.g. 05" required />
        </div>
        <button class="btn-primary" type="submit">Enter Dashboard</button>
      </form>
      <div class="g-signin2" data-onsuccess="onGoogleSignIn"></div>
    </div>

    <!-- Parent Section -->
    <div id="parent" class="section">
      <form id="parentForm">
        <div class="input-group">
          <label>Parent / Guardian Name</label>
          <input type="text" name="parentName" placeholder="As registered in school" required />
        </div>
        <div class="input-group">
          <label>Child Name</label>
          <input type="text" name="childName" placeholder="Student's full name" required />
        </div>
        <div class="input-group">
          <label>Child Class</label>
          <select name="childClass" required>
            <option value="" disabled selected>Select Class</option>
            <option>Nursery</option><option>LKG</option><option>UKG</option>
            <option>1</option><option>2</option><option>3</option><option>4</option>
            <option>5</option><option>6</option><option>7</option><option>8</option>
          </select>
        </div>
        <button class="btn-primary" type="submit">Verify & Proceed</button>
      </form>
      <p id="parentError" class="error hidden">
        Your child is not registered in the school database.<br/>
        Please contact school administration.
        <br/><br/>
        <button class="btn-outline" onclick="retryParent()">Retry</button>
        <button class="btn-primary" onclick="contactSchool()">Contact School</button>
      </p>
    </div>

    <!-- Teacher Section -->
    <div id="teacher" class="section">
      <form id="teacherForm">
        <div class="input-group">
          <label>Teacher Name</label>
          <input type="text" name="teacherName" value="Abutalha" required />
        </div>
        <div class="input-group">
          <label>Password</label>
          <input type="password" name="teacherPass" placeholder="Enter password" required />
        </div>
        <button class="btn-primary" type="submit">Login</button>
      </form>
    </div>
  </div>

  <!-- Firebase & GSI -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB0fHtqeoerlckQ2RXx_VC86cZz_BJaIIU",
      authDomain: "mkps-balrampur.firebaseapp.com",
      projectId: "mkps-balrampur",
      storageBucket: "mkps-balrampur.firebasestorage.app",
      messagingSenderId: "469227187804",
      appId: "1:469227187804:web:8abdb9b75ed05b7eadc099",
      measurementId: "G-TYKBNS9SX2"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    /* Tab Switching */
    document.querySelectorAll('.tab').forEach(tab=>{
      tab.addEventListener('click',()=>{
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        const role = tab.dataset.role;
        document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
        document.getElementById(role).classList.add('active');
      });
    });

    /* Student Form */
    document.getElementById('studentForm').addEventListener('submit',async e=>{
      e.preventDefault();
      const data = Object.fromEntries(new FormData(e.target));
      await db.collection('students').add(data);
      localStorage.setItem('student', JSON.stringify(data));
      window.location.href = 'dashboard.html';
    });

    /* Google Sign-In */
    function onGoogleSignIn(googleUser){
      const profile = googleUser.getBasicProfile();
      const studentData = {
        name: profile.getName(),
        parentName: 'Google User',
        class: 'Unknown',
        rollNo: 'G' + profile.getId()
      };
      db.collection('students').add(studentData).then(()=>{
        localStorage.setItem('student', JSON.stringify(studentData));
        window.location.href = 'dashboard.html';
      });
    }

    /* Parent Validation */
    document.getElementById('parentForm').addEventListener('submit',async e=>{
      e.preventDefault();
      const {parentName, childName, childClass} = Object.fromEntries(new FormData(e.target));
      const snap = await db.collection('students')
                           .where('parentName','==',parentName)
                           .where('name','==',childName)
                           .where('class','==',childClass).get();
      if(snap.size){
        localStorage.setItem('child', JSON.stringify(snap.docs[0].data()));
        window.location.href = 'parent.html';
      }else{
        document.getElementById('parentError').classList.remove('hidden');
        e.target.reset();
      }
    });

    /* Parent Helpers */
    function retryParent(){document.getElementById('parentError').classList.add('hidden');}
    function contactSchool(){window.location='mailto:madamsir066@gmail.com';}

    /* Teacher Login */
    document.getElementById('teacherForm').addEventListener('submit',e=>{
      e.preventDefault();
      const {teacherName, teacherPass} = Object.fromEntries(new FormData(e.target));
      if(teacherName==='Abutalha' && teacherPass==='Secret123'){
        localStorage.setItem('teacher', teacherName);
        window.location.href = 'teacher.html';
      }else{
        alert('❌ Invalid credentials');
      }
    });
  </script>
</body>
</html>
