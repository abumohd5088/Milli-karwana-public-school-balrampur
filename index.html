<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Milli Karwaan Public School | Login</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
    body{
      min-height:100vh;display:flex;align-items:center;justify-content:center;
      background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
      color:#fff;transition:0.4s ease;
    }
    .card{
      background:rgba(255,255,255,0.08);backdrop-filter:blur(15px);
      padding:2rem;border-radius:20px;width:95%;max-width:420px;
      box-shadow:0 8px 30px rgba(0,0,0,0.5);animation:fadeIn 1s ease-in-out;
    }
    .logo{text-align:center;margin-bottom:1rem;}
    .logo img{width:90px;filter:drop-shadow(0 0 8px #fff);}
    h2{text-align:center;margin-bottom:1rem;font-weight:600;}
    label{font-size:0.9rem;margin-top:1rem;display:block;}
    input,select{
      width:100%;padding:0.8rem;margin-top:0.3rem;border:none;
      border-radius:10px;background:rgba(255,255,255,0.2);
      color:#fff;outline:none;transition:0.3s;
    }
    input::placeholder{color:#ddd;}
    input:focus,select:focus{background:rgba(255,255,255,0.3);}
    button{
      margin-top:1.5rem;width:100%;padding:0.9rem;border:none;
      border-radius:12px;background:linear-gradient(135deg,#00c6ff,#0072ff);
      color:#fff;font-weight:600;cursor:pointer;transition:0.3s;
    }
    button:hover{opacity:0.85;transform:scale(1.02);}
    .google-btn{
      margin-top:1rem;width:100%;background:#fff;color:#444;
      font-weight:600;display:flex;align-items:center;justify-content:center;
      gap:10px;padding:0.8rem;border-radius:12px;
      box-shadow:0 4px 10px rgba(0,0,0,0.2);cursor:pointer;
    }
    .google-btn img{width:20px;}
    .toggle{margin-top:1rem;text-align:center;cursor:pointer;font-size:0.85rem;}
    .ai-box{
      margin-top:1.5rem;padding:1rem;border-radius:12px;
      background:rgba(0,0,0,0.4);font-size:0.9rem;
    }
    .ai-box textarea{
      width:100%;border:none;border-radius:8px;padding:0.6rem;
      margin-bottom:0.5rem;resize:none;font-size:0.9rem;
    }
    .ai-response{margin-top:0.5rem;font-size:0.85rem;color:#f0f0f0;}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
  </style>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <div class="card">
    <div class="logo">
      <img src="https://i.postimg.cc/ryGx49TB/erasebg-transformed.png" alt="School Logo">
    </div>
    <h2>Welcome to MKPS Balrampur</h2>

    <!-- Student Form -->
    <form id="studentForm">
      <label>Student Name</label>
      <input type="text" id="studentName" placeholder="Enter your name" required>
      <label>Class</label>
      <select id="studentClass" required>
        <option value="">Select Class</option>
        <option value="1">Class 1</option>
        <option value="2">Class 2</option>
        <option value="3">Class 3</option>
        <option value="4">Class 4</option>
        <option value="5">Class 5</option>
        <option value="6">Class 6</option>
        <option value="7">Class 7</option>
        <option value="8">Class 8</option>
      </select>
      <label>Parent Name</label>
      <input type="text" id="parentName" placeholder="Enter parent name" required>
      <button type="submit">Login</button>
    </form>

    <!-- Google Login -->
    <div id="g_id_onload"
      data-client_id="529549341206-st52n2e42jkobemc9kenva0jf8ccmhf2.apps.googleusercontent.com"
      data-callback="handleGoogleResponse"
      data-auto_prompt="false">
    </div>
    <div class="g_id_signin google-btn" data-type="standard" data-shape="rect" data-theme="outline" data-text="signin_with" data-size="large">
      <img src="https://developers.google.com/identity/images/g-logo.png" alt=""> Sign in with Google
    </div>

    <!-- AI Assistant -->
    <div class="ai-box">
      <p>ü§ñ Ask AI (Homework Help):</p>
      <textarea id="aiQuery" rows="2" placeholder="Type your question..."></textarea>
      <button type="button" onclick="askAI()">Ask AI</button>
      <div class="ai-response" id="aiResponse"></div>
    </div>

    <div class="toggle" onclick="toggleTheme()">üåó Toggle Dark/Light</div>
  </div>

  <script>
    // Theme Toggle
    function toggleTheme(){
      document.body.classList.toggle("light");
      if(document.body.classList.contains("light")){
        document.body.style.background="linear-gradient(135deg,#f5f7fa,#c3cfe2)";
        document.body.style.color="#000";
      }else{
        document.body.style.background="linear-gradient(135deg,#0f2027,#203a43,#2c5364)";
        document.body.style.color="#fff";
      }
    }

    // Manual Form Login
    document.getElementById("studentForm").addEventListener("submit",function(e){
      e.preventDefault();
      let student={
        name:document.getElementById("studentName").value.trim(),
        class:document.getElementById("studentClass").value,
        parent:document.getElementById("parentName").value.trim()
      };
      localStorage.setItem("mkps_student",JSON.stringify(student));
      window.location.href="dashboard.html";
    });

    // Google Login Response
    function handleGoogleResponse(response){
      try{
        const data=jwt_decode(response.credential);
        let student={name:data.name,email:data.email,class:"",parent:"GoogleLogin"};
        localStorage.setItem("mkps_student",JSON.stringify(student));
        window.location.href="dashboard.html";
      }catch(err){alert("Google login failed: "+err.message);}
    }

    // JWT Decode
    function jwt_decode(token){
      let base64Url=token.split('.')[1];
      let base64=base64Url.replace(/-/g,'+').replace(/_/g,'/');
      let jsonPayload=decodeURIComponent(atob(base64).split('').map(c=>{
        return'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    // AI Assistant (Gemini API)
    async function askAI(){
      const query=document.getElementById("aiQuery").value.trim();
      const output=document.getElementById("aiResponse");
      if(!query){output.innerText="‚ö†Ô∏è Please enter a question.";return;}
      output.innerText="‚è≥ Thinking...";
      try{
        const res=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=AIzaSyCqGS8gb5kh7Jr0pv8d84LxCLhgHU-O_VU",{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({contents:[{parts:[{text:query}]}]})
        });
        const data=await res.json();
        output.innerText=data?.candidates?.[0]?.content?.parts?.[0]?.text || "‚ùå No answer.";
      }catch(err){output.innerText="‚ö†Ô∏è AI Error: "+err.message;}
    }

    // Auto redirect if logged in
    if(localStorage.getItem("mkps_student")){
      window.location.href="dashboard.html";
    }
  </script>
</body>
</html>
