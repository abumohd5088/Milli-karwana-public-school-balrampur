<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Milli Karwaan Public School | Login</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
    body{
      min-height:100vh;display:flex;align-items:center;justify-content:center;
      background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
      color:#fff;overflow:hidden;
    }

    /* Floating animated background circles */
    .circle{
      position:absolute;border-radius:50%;background:rgba(255,255,255,0.08);
      animation:float 12s infinite ease-in-out;
    }
    .circle:nth-child(1){width:120px;height:120px;top:10%;left:15%;animation-delay:0s;}
    .circle:nth-child(2){width:200px;height:200px;bottom:10%;right:10%;animation-delay:3s;}
    .circle:nth-child(3){width:80px;height:80px;bottom:25%;left:20%;animation-delay:6s;}

    @keyframes float{
      0%,100%{transform:translateY(0);}
      50%{transform:translateY(-30px);}
    }

    .card{
      background:rgba(255,255,255,0.1);
      backdrop-filter:blur(20px);
      padding:2rem;border-radius:25px;width:95%;max-width:420px;
      box-shadow:0 8px 30px rgba(0,0,0,0.5);
      animation:fadeIn 1.2s ease-in-out;
      z-index:2;position:relative;
    }
    .logo{text-align:center;margin-bottom:1rem;}
    .logo img{width:90px;filter:drop-shadow(0 0 8px #00c6ff);}
    h2{text-align:center;margin-bottom:1rem;font-weight:700;font-size:1.6rem;}

    label{font-size:0.9rem;margin-top:1rem;display:block;}
    input,select{
      width:100%;padding:0.8rem;margin-top:0.4rem;border:none;
      border-radius:12px;background:rgba(255,255,255,0.2);
      color:#fff;outline:none;transition:0.3s;
    }
    input:focus,select:focus{
      box-shadow:0 0 10px #00c6ff;transform:scale(1.02);
    }
    input::placeholder{color:#ddd;}

    button{
      margin-top:1.5rem;width:100%;padding:0.9rem;border:none;
      border-radius:12px;background:linear-gradient(135deg,#00c6ff,#0072ff);
      color:#fff;font-weight:600;cursor:pointer;transition:0.3s;
      font-size:1rem;box-shadow:0 5px 15px rgba(0,114,255,0.4);
    }
    button:hover{transform:translateY(-2px);opacity:0.9;}

    .google-btn{
      margin-top:1rem;width:100%;background:#fff;color:#444;
      font-weight:600;display:flex;align-items:center;justify-content:center;
      gap:10px;border-radius:12px;padding:0.8rem;
      box-shadow:0 5px 15px rgba(0,0,0,0.2);cursor:pointer;
      transition:0.3s;
    }
    .google-btn:hover{transform:translateY(-2px);opacity:0.9;}
    .google-btn img{width:22px;}

    .toggle{
      margin-top:1rem;text-align:center;cursor:pointer;font-size:0.9rem;
    }

    @keyframes fadeIn{from{opacity:0;transform:translateY(30px);}to{opacity:1;transform:translateY(0);}}

    /* Modal for Google Extra Form */
    .modal{
      display:none;position:fixed;top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,0.6);backdrop-filter:blur(5px);
      display:flex;align-items:center;justify-content:center;z-index:9999;
    }
    .modal-content{
      background:#fff;color:#000;padding:2rem;border-radius:20px;
      width:90%;max-width:400px;animation:fadeIn 0.5s;
    }
    .modal-content h3{margin-bottom:1rem;}
    .modal-content input,.modal-content select{
      width:100%;padding:0.7rem;margin:0.5rem 0;border-radius:10px;
      border:1px solid #ccc;
    }
    .modal-content button{
      background:linear-gradient(135deg,#00c6ff,#0072ff);
      color:#fff;width:100%;padding:0.8rem;border:none;border-radius:12px;
      font-weight:600;margin-top:1rem;cursor:pointer;
    }
  </style>

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <!-- Floating Background -->
  <div class="circle"></div>
  <div class="circle"></div>
  <div class="circle"></div>

  <div class="card">
    <div class="logo">
      <img src="https://i.postimg.cc/ryGx49TB/erasebg-transformed.png" alt="School Logo">
    </div>
    <h2>Welcome to MKPS Balrampur</h2>

    <!-- Manual Login -->
    <form id="studentForm">
      <label>Student Name</label>
      <input type="text" id="studentName" placeholder="Enter your name" required>
      <label>Class</label>
      <select id="studentClass" required>
        <option value="">Select Class</option>
        <option value="1">Class 1</option>
        <option value="2">Class 2</option>
        <option value="3">Class 3</option>
        <option value="4">Class 4</option>
        <option value="5">Class 5</option>
        <option value="6">Class 6</option>
        <option value="7">Class 7</option>
        <option value="8">Class 8</option>
      </select>
      <label>Parent Name</label>
      <input type="text" id="parentName" placeholder="Enter parent name" required>
      <button type="submit">Login</button>
    </form>

    <!-- Google Login -->
    <div id="g_id_onload"
      data-client_id="529549341206-st52n2e42jkobemc9kenva0jf8ccmhf2.apps.googleusercontent.com"
      data-callback="handleGoogleResponse"
      data-auto_prompt="false">
    </div>
    <div class="g_id_signin google-btn" data-type="standard" data-shape="rect" data-theme="outline" data-text="signin_with" data-size="large">
      <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg"/> Sign in with Google
    </div>

    <div class="toggle" onclick="toggleTheme()">ðŸŒ— Toggle Dark/Light</div>
  </div>

  <!-- Modal for Google Login Extra Details -->
  <div id="googleModal" class="modal" style="display:none;">
    <div class="modal-content">
      <h3>Complete Your Profile</h3>
      <form id="googleExtraForm">
        <label>Student Name</label>
        <input type="text" id="gStudentName" required>
        <label>Class</label>
        <select id="gStudentClass" required>
          <option value="">Select Class</option>
          <option value="1">Class 1</option>
          <option value="2">Class 2</option>
          <option value="3">Class 3</option>
          <option value="4">Class 4</option>
          <option value="5">Class 5</option>
          <option value="6">Class 6</option>
          <option value="7">Class 7</option>
          <option value="8">Class 8</option>
        </select>
        <label>Parent Name</label>
        <input type="text" id="gParentName" required>
        <button type="submit">Save & Continue</button>
      </form>
    </div>
  </div>

  <script>
    // Theme toggle
    function toggleTheme(){
      document.body.classList.toggle("light");
      if(document.body.classList.contains("light")){
        document.body.style.background="linear-gradient(135deg,#f5f7fa,#c3cfe2)";
        document.body.style.color="#000";
      }else{
        document.body.style.background="linear-gradient(135deg,#0f2027,#203a43,#2c5364)";
        document.body.style.color="#fff";
      }
    }

    // Manual form login
    document.getElementById("studentForm").addEventListener("submit",function(e){
      e.preventDefault();
      let student={
        name:document.getElementById("studentName").value.trim(),
        class:document.getElementById("studentClass").value,
        parent:document.getElementById("parentName").value.trim()
      };
      if(!student.name||!student.class||!student.parent){alert("Please fill all fields");return;}
      localStorage.setItem("mkps_student",JSON.stringify(student));
      window.location.href="dashboard.html";
    });

    // Google login response
    let googleUserData={};
    function handleGoogleResponse(response){
      try{
        const data=jwt_decode(response.credential);
        googleUserData={email:data.email};
        // Show modal to complete profile
        document.getElementById("googleModal").style.display="flex";
      }catch(err){
        alert("Google login failed: "+err.message);
      }
    }

    // Save extra Google info
    document.getElementById("googleExtraForm").addEventListener("submit",function(e){
      e.preventDefault();
      let student={
        name:document.getElementById("gStudentName").value.trim(),
        class:document.getElementById("gStudentClass").value,
        parent:document.getElementById("gParentName").value.trim(),
        email:googleUserData.email || ""
      };
      localStorage.setItem("mkps_student",JSON.stringify(student));
      window.location.href="dashboard.html";
    });

    // JWT decode
    function jwt_decode(token){
      let base64Url=token.split('.')[1];
      let base64=base64Url.replace(/-/g,'+').replace(/_/g,'/');
      let jsonPayload=decodeURIComponent(atob(base64).split('').map(c=>{
        return'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    // If already logged in â†’ go to dashboard
    if(localStorage.getItem("mkps_student")){
      window.location.href="dashboard.html";
    }
  </script>
</body>
</html>
